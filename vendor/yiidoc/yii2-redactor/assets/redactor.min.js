(function(c){if(!Function.prototype.bind){Function.prototype.bind=function(e){var d=this;return function(){return d.apply(e)}}}var a=0;c.fn.redactor=function(e){var f=[];var d=Array.prototype.slice.call(arguments,1);if(typeof e==="string"){this.each(function(){var h=c.data(this,"redactor");var i;if(e.search(/\./)!="-1"){i=e.split(".");if(typeof h[i[0]]!="undefined"){i=h[i[0]][i[1]]}}else{i=h[e]}if(typeof h!=="undefined"&&c.isFunction(i)){var g=i.apply(h,d);if(g!==undefined&&g!==h){f.push(g)}}else{c.error('No such method "'+e+'" for Redactor')}})}else{this.each(function(){c.data(this,"redactor",{});c.data(this,"redactor",b(this,e))})}if(f.length===0){return this}else{if(f.length===1){return f[0]}else{return f}}};function b(e,d){return new b.prototype.init(e,d)}c.Redactor=b;c.Redactor.VERSION="10.1.1";c.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils","linkify"];c.Redactor.opts={lang:"en",direction:"ltr",plugins:false,focus:false,focusEnd:false,placeholder:false,visual:true,tabindex:false,minHeight:false,maxHeight:false,linebreaks:false,replaceDivs:true,paragraphize:true,cleanStyleOnEnter:false,enterKey:true,cleanOnPaste:true,cleanSpaces:true,pastePlainText:false,autosave:false,autosaveName:false,autosaveInterval:60,autosaveOnChange:false,autosaveFields:false,linkTooltip:true,linkProtocol:"http",linkNofollow:false,linkSize:50,imageEditable:true,imageLink:true,imagePosition:true,imageFloatMargin:"10px",imageResizable:true,imageUpload:null,imageUploadParam:"file",uploadImageField:false,dragImageUpload:true,fileUpload:null,fileUploadParam:"file",dragFileUpload:true,s3:false,convertLinks:true,convertUrlLinks:true,convertImageLinks:true,convertVideoLinks:true,preSpaces:4,tabAsSpaces:false,tabKey:true,scrollTarget:false,toolbar:true,toolbarFixed:true,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:false,toolbarOverflow:false,source:true,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:false,tabifier:true,deniedTags:["script","style"],allowedTags:false,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:false,replaceTags:[["strike","del"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:false,removeAttr:false,allowedAttr:false,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:false,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/ig,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/ig}},codemirror:false};b.fn=c.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(g,e){this.$element=c(g);this.uuid=a++;this.rtePaste=false;this.$pasteBox=false;this.loadOptions(e);this.loadModules();this.formatting={};c.merge(this.opts.blockLevelElements,this.opts.alignmentTags);this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i");this.tidy.setupAllowed();if(this.opts.deniedTags!==false){var d=["html","head","link","body","meta","applet"];for(var f=0;f<d.length;f++){this.opts.deniedTags.push(d[f])}}this.lang.load();c.extend(this.opts.shortcuts,this.opts.shortcutsAdd);this.core.setCallback("start");this.start=true;this.build.run()},loadOptions:function(d){this.opts=c.extend({},c.extend(true,{},c.Redactor.opts),this.$element.data(),d)},getModuleMethods:function(d){return Object.getOwnPropertyNames(d).filter(function(e){return typeof d[e]=="function"})},loadModules:function(){var d=c.Redactor.modules.length;for(var e=0;e<d;e++){this.bindModuleMethods(c.Redactor.modules[e])}},bindModuleMethods:function(f){if(typeof this[f]=="undefined"){return}this[f]=this[f]();var e=this.getModuleMethods(this[f]);var d=e.length;for(var g=0;g<d;g++){this[f][e[g]]=this[f][e[g]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(d){if(!this.utils.browser("msie")){this.$editor.focus()}this.buffer.set();this.selection.save();this.alignment.blocks=this.selection.getBlocks();this.alignment.type=d;if(this.alignment.isLinebreaksOrNoBlocks()){this.alignment.setText()}else{this.alignment.setBlocks()}this.selection.restore();this.code.sync()},setText:function(){var d=this.selection.wrap("div");c(d).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){c.each(this.alignment.blocks,c.proxy(function(e,f){var d=this.utils.getAlignmentElement(f);if(!d){return}if(this.alignment.isNeedReplaceElement(d)){this.alignment.replaceElement(d)}else{this.alignment.alignElement(d)}},this))},isLinebreaksOrNoBlocks:function(){return(this.opts.linebreaks&&this.alignment.blocks[0]===false)},isNeedReplaceElement:function(d){return(this.alignment.type===""&&typeof(d.data("tagblock"))!=="undefined")},replaceElement:function(d){d.replaceWith(d.html())},alignElement:function(d){d.css("text-align",this.alignment.type);this.utils.removeEmptyAttr(d,"style")}}},autosave:function(){return{html:false,enable:function(){if(!this.opts.autosave){return}this.autosave.name=(this.opts.autosaveName)?this.opts.autosaveName:this.$textarea.attr("name");if(this.opts.autosaveOnChange){return}this.autosaveInterval=setInterval(this.autosave.load,this.opts.autosaveInterval*1000)},onChange:function(){if(!this.opts.autosaveOnChange){return}this.autosave.load()},load:function(){this.autosave.source=this.code.get();if(this.autosave.html===this.autosave.source){return}var e={};e.name=this.autosave.name;e[this.autosave.name]=this.autosave.source;e=this.autosave.getHiddenFields(e);var d=c.ajax({url:this.opts.autosave,type:"post",data:e});d.done(this.autosave.success)},getHiddenFields:function(d){if(this.opts.autosaveFields===false||typeof this.opts.autosaveFields!=="object"){return d}c.each(this.opts.autosaveFields,c.proxy(function(f,e){if(e!==null&&e.toString().indexOf("#")===0){e=c(e).val()}d[f]=e},this));return d},success:function(f){var d;try{d=c.parseJSON(f)}catch(h){d=f}var g=(typeof d.error=="undefined")?"autosave":"autosaveError";this.core.setCallback(g,this.autosave.name,d);this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(d){this.block.clearStyle=false;var e,f;if(typeof this.formatting[d].data!="undefined"){e="data"}else{if(typeof this.formatting[d].attr!="undefined"){e="attr"}else{if(typeof this.formatting[d]["class"]!="undefined"){e="class"}}}if(typeof this.formatting[d].clear!="undefined"){this.block.clearStyle=true}if(e){f=this.formatting[d][e]}this.block.format(this.formatting[d].tag,e,f)},format:function(d,f,g){if(d=="quote"){d="blockquote"}var e=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];if(c.inArray(d,e)==-1){return}this.block.isRemoveInline=(d=="pre"||d.search(/h[1-6]/i)!=-1);if(!this.utils.browser("msie")){this.$editor.focus()}this.block.blocks=this.selection.getBlocks();this.block.blocksSize=this.block.blocks.length;this.block.type=f;this.block.value=g;this.buffer.set();this.selection.save();this.block.set(d);this.selection.restore();this.code.sync()},set:function(d){this.selection.get();this.block.containerTag=this.range.commonAncestorContainer.tagName;if(this.range.collapsed){this.block.setCollapsed(d)}else{this.block.setMultiple(d)}},setCollapsed:function(d){var h=this.block.blocks[0];if(h===false){return}if(h.tagName=="LI"){if(d!="blockquote"){return}this.block.formatListToBlockquote();return}var g=(this.block.containerTag=="TD"||this.block.containerTag=="TH");if(g&&!this.opts.linebreaks){document.execCommand("formatblock",false,"<"+d+">");h=this.selection.getBlock();this.block.toggle(c(h))}else{if(h.tagName.toLowerCase()!=d){if(this.opts.linebreaks&&d=="p"){c(h).prepend("<br>").append("<br>");this.utils.replaceWithContents(h)}else{var f=this.utils.replaceToTag(h,d);this.block.toggle(f);if(d!="p"&&d!="blockquote"){f.find("img").remove()}if(this.block.isRemoveInline){this.utils.removeInlineTags(f)}if(d=="p"||this.block.headTag){f.find("p").contents().unwrap()}this.block.formatTableWrapping(f)}}else{if(d=="blockquote"&&h.tagName.toLowerCase()==d){if(this.opts.linebreaks){c(h).prepend("<br>").append("<br>");this.utils.replaceWithContents(h)}else{var e=this.utils.replaceToTag(h,"p");this.block.toggle(e)}}else{if(h.tagName.toLowerCase()==d){this.block.toggle(c(h))}}}}if(typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"){c(h).removeAttr("class").removeAttr("style")}},setMultiple:function(n){var f=this.block.blocks[0];var l=(this.block.containerTag=="TD"||this.block.containerTag=="TH");if(f!==false&&this.block.blocksSize===1){if(f.tagName.toLowerCase()==n&&n=="blockquote"){if(this.opts.linebreaks){c(f).prepend("<br>").append("<br>");this.utils.replaceWithContents(f)}else{var m=this.utils.replaceToTag(f,"p");this.block.toggle(m)}}else{if(f.tagName=="LI"){if(n!="blockquote"){return}this.block.formatListToBlockquote()}else{if(this.block.containerTag=="BLOCKQUOTE"){this.block.formatBlockquote(n)}else{if(this.opts.linebreaks&&((l)||(this.range.commonAncestorContainer!=f))){this.block.formatWrap(n)}else{if(this.opts.linebreaks&&n=="p"){c(f).prepend("<br>").append("<br>");this.utils.replaceWithContents(f)}else{if(f.tagName==="TD"){this.block.formatWrap(n)}else{var e=this.utils.replaceToTag(f,n);this.block.toggle(e);if(this.block.isRemoveInline){this.utils.removeInlineTags(e)}if(n=="p"||this.block.headTag){e.find("p").contents().unwrap()}}}}}}}}else{if(this.opts.linebreaks||n!="p"){if(n=="blockquote"){var j=0;for(var h=0;h<this.block.blocksSize;h++){if(this.block.blocks[h].tagName=="BLOCKQUOTE"){j++}}if(j==this.block.blocksSize){c.each(this.block.blocks,c.proxy(function(p,q){var o=false;if(this.opts.linebreaks){c(q).prepend("<br>").append("<br>");o=this.utils.replaceWithContents(q)}else{o=this.utils.replaceToTag(q,"p")}if(o&&typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"){o.removeAttr("class").removeAttr("style")}},this));return}}this.block.formatWrap(n)}else{var k=0;var g=false;if(this.block.type=="class"){g="toggle";k=c(this.block.blocks).filter("."+this.block.value).length;if(this.block.blocksSize==k){g="toggle"}else{if(this.block.blocksSize>k){g="set"}else{if(k===0){g="set"}}}}var d=["ul","ol","li","td","th","dl","dt","dd"];c.each(this.block.blocks,c.proxy(function(p,q){if(c.inArray(q.tagName.toLowerCase(),d)!=-1){return}var o=this.utils.replaceToTag(q,n);if(g){if(g=="toggle"){this.block.toggle(o)}else{if(g=="remove"){this.block.remove(o)}else{if(g=="set"){this.block.setForce(o)}}}}else{this.block.toggle(o)}if(n!="p"&&n!="blockquote"){o.find("img").remove()}if(this.block.isRemoveInline){this.utils.removeInlineTags(o)}if(n=="p"||this.block.headTag){o.find("p").contents().unwrap()}if(typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"){o.removeAttr("class").removeAttr("style")}},this))}}},setForce:function(d){if(this.block.clearStyle){d.removeAttr("class").removeAttr("style")}if(this.block.type=="class"){d.addClass(this.block.value);return}else{if(this.block.type=="attr"||this.block.type=="data"){d.attr(this.block.value.name,this.block.value.value);return}}},toggle:function(d){if(this.block.clearStyle){d.removeAttr("class").removeAttr("style")}if(this.block.type=="class"){d.toggleClass(this.block.value);return}else{if(this.block.type=="attr"||this.block.type=="data"){if(d.attr(this.block.value.name)==this.block.value.value){d.removeAttr(this.block.value.name)}else{d.attr(this.block.value.name,this.block.value.value)}return}else{d.removeAttr("style class");return}}},remove:function(d){d.removeClass(this.block.value)},formatListToBlockquote:function(){var e=c(this.block.blocks[0]).closest("ul, ol",this.$editor[0]);c(e).find("ul, ol").contents().unwrap();c(e).find("li").append(c("<br>")).contents().unwrap();var d=this.utils.replaceToTag(e,"blockquote");this.block.toggle(d)},formatBlockquote:function(d){document.execCommand("outdent");document.execCommand("formatblock",false,d);this.clean.clearUnverified();this.$editor.find("p:empty").remove();var e=this.selection.getBlock();if(d!="p"){c(e).find("img").remove()}if(!this.opts.linebreaks){this.block.toggle(c(e))}this.$editor.find("ul, ol, tr, blockquote, p").each(c.proxy(this.utils.removeEmpty,this));if(this.opts.linebreaks&&d=="p"){this.utils.replaceWithContents(e)}},formatWrap:function(d){if(this.block.containerTag=="UL"||this.block.containerTag=="OL"){if(d=="blockquote"){this.block.formatListToBlockquote()}else{return}}var g=this.selection.wrap(d);if(g===false){return}var e=c(g);this.block.formatTableWrapping(e);var f=e.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");if((this.opts.linebreaks&&d=="p")||d=="pre"||d=="blockquote"){f.append("<br />")}f.contents().unwrap();if(d!="p"&&d!="blockquote"){e.find("img").remove()}c.each(this.block.blocks,c.proxy(this.utils.removeEmpty,this));e.append(this.selection.getMarker(2));if(!this.opts.linebreaks){this.block.toggle(e)}this.$editor.find("ul, ol, tr, blockquote, p").each(c.proxy(this.utils.removeEmpty,this));e.find("blockquote:empty").remove();if(this.block.isRemoveInline){this.utils.removeInlineTags(e)}if(this.opts.linebreaks&&d=="p"){this.utils.replaceWithContents(e)}},formatTableWrapping:function(d){if(d.closest("table",this.$editor[0]).length===0){return}if(d.closest("tr",this.$editor[0]).length===0){d.wrap("<tr>")}if(d.closest("td",this.$editor[0]).length===0&&d.closest("th").length===0){d.wrap("<td>")}},removeData:function(d,e){var f=this.selection.getBlocks();c(f).removeAttr("data-"+d);this.code.sync()},setData:function(d,e){var f=this.selection.getBlocks();c(f).attr("data-"+d,e);this.code.sync()},toggleData:function(d,e){var f=this.selection.getBlocks();c.each(f,function(){if(c(this).attr("data-"+d)){c(this).removeAttr("data-"+d)}else{c(this).attr("data-"+d,e)}})},removeAttr:function(d,e){var f=this.selection.getBlocks();c(f).removeAttr(d);this.code.sync()},setAttr:function(d,e){var f=this.selection.getBlocks();c(f).attr(d,e);this.code.sync()},toggleAttr:function(d,e){var f=this.selection.getBlocks();c.each(f,function(){if(c(this).attr(name)){c(this).removeAttr(name)}else{c(this).attr(name,e)}})},removeClass:function(d){var e=this.selection.getBlocks();c(e).removeClass(d);this.utils.removeEmptyAttr(e,"class");this.code.sync()},setClass:function(d){var e=this.selection.getBlocks();c(e).addClass(d);this.code.sync()},toggleClass:function(d){var e=this.selection.getBlocks();c(e).toggleClass(d);this.code.sync()}}},buffer:function(){return{set:function(d){if(typeof d=="undefined"||d=="undo"){this.buffer.setUndo()}else{this.buffer.setRedo()}},setUndo:function(){this.selection.save();this.opts.buffer.push(this.$editor.html());this.selection.restore()},setRedo:function(){this.selection.save();this.opts.rebuffer.push(this.$editor.html());this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){if(this.opts.buffer.length===0){return}this.buffer.set("redo");this.buffer.getUndo();this.selection.restore();setTimeout(c.proxy(this.observe.load,this),50)},redo:function(){if(this.opts.rebuffer.length===0){return}this.buffer.set("undo");this.buffer.getRedo();this.selection.restore();setTimeout(c.proxy(this.observe.load,this),50)}}},build:function(){return{run:function(){this.build.createContainerBox();this.build.loadContent();this.build.loadEditor();this.build.enableEditor();this.build.setCodeAndCall()},isTextarea:function(){return(this.$element[0].tagName==="TEXTAREA")},createContainerBox:function(){this.$box=c('<div class="redactor-box" />')},createTextarea:function(){this.$textarea=c("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return((typeof(name)=="undefined"))?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var d=(this.build.isTextarea())?"val":"html";this.content=c.trim(this.$element[d]())},enableEditor:function(){this.$editor.attr({contenteditable:true,dir:this.opts.direction})},loadEditor:function(){var d=(this.build.isTextarea())?"fromTextarea":"fromElement";this.build[d]()},fromTextarea:function(){this.$editor=c("<div />");this.$textarea=this.$element;this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element);this.$editor.addClass("redactor-editor");this.$element.hide()},fromElement:function(){this.$editor=this.$element;this.build.createTextarea();this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea);this.$editor.addClass("redactor-editor");this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content);this.build.setOptions();this.build.callEditor();if(this.opts.visual){return}setTimeout(c.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing();this.build.setEvents();this.build.setHelpers();if(this.opts.toolbar){this.opts.toolbar=this.toolbar.init();this.toolbar.build()}this.modal.loadTemplates();this.build.plugins();setTimeout(c.proxy(this.observe.load,this),4);this.core.setCallback("init")},setOptions:function(){c(this.$textarea).attr("dir",this.opts.direction);if(this.opts.linebreaks){this.$editor.addClass("redactor-linebreaks")}if(this.opts.tabindex){this.$editor.attr("tabindex",this.opts.tabindex)}if(this.opts.minHeight){this.$editor.css("minHeight",this.opts.minHeight)}if(this.opts.maxHeight){this.$editor.css("maxHeight",this.opts.maxHeight)}},setEventDropUpload:function(f){f.preventDefault();if(!this.opts.dragImageUpload||!this.opts.dragFileUpload){return}var d=f.dataTransfer.files;this.upload.directUpload(d[0],f)},setEventDrop:function(d){this.code.sync();setTimeout(this.clean.clearUnverified,1);this.core.setCallback("drop",d)},setEvents:function(){this.$editor.on("drop.redactor",c.proxy(function(f){f=f.originalEvent||f;if(window.FormData===undefined||!f.dataTransfer){return true}if(f.dataTransfer.files.length===0){return this.build.setEventDrop(f)}else{this.build.setEventDropUpload(f)}setTimeout(this.clean.clearUnverified,1);this.core.setCallback("drop",f)},this));this.$editor.on("click.redactor",c.proxy(function(h){var g=this.core.getEvent();var f=(g=="click"||g=="arrow")?false:"click";this.core.addEvent(f);this.utils.disableSelectAll();this.core.setCallback("click",h)},this));this.$editor.on("paste.redactor",c.proxy(this.paste.init,this));this.$editor.on("cut.redactor",c.proxy(this.code.sync,this));this.$editor.on("keydown.redactor",c.proxy(this.keydown.init,this));this.$editor.on("keyup.redactor",c.proxy(this.keyup.init,this));if(c.isFunction(this.opts.codeKeydownCallback)){this.$textarea.on("keydown.redactor-textarea",c.proxy(this.opts.codeKeydownCallback,this))}if(c.isFunction(this.opts.codeKeyupCallback)){this.$textarea.on("keyup.redactor-textarea",c.proxy(this.opts.codeKeyupCallback,this))}if(c.isFunction(this.opts.focusCallback)){this.$editor.on("focus.redactor",c.proxy(this.opts.focusCallback,this))}var d;c(document).on("mousedown",function(f){d=f.target});this.$editor.on("blur.redactor",c.proxy(function(f){if(this.rtePaste){return}if(!this.build.isBlured(d)){return}this.utils.disableSelectAll();if(c.isFunction(this.opts.blurCallback)){this.core.setCallback("blur",f)}},this))},isBlured:function(e){var d=c(e);return(!d.hasClass("redactor-toolbar, redactor-dropdown")&&!d.is("#redactor-modal")&&d.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length===0)},setHelpers:function(){if(this.linkify.isEnabled()){this.linkify.format()}this.placeholder.enable();if(this.opts.focus){setTimeout(this.focus.setStart,100)}if(this.opts.focusEnd){setTimeout(this.focus.setEnd,100)}},plugins:function(){if(!this.opts.plugins){return}if(!RedactorPlugins){return}c.each(this.opts.plugins,c.proxy(function(f,g){if(typeof RedactorPlugins[g]==="undefined"){return}if(c.inArray(g,c.Redactor.modules)!==-1){c.error('Plugin name "'+g+"\" matches the name of the Redactor's module.");return}if(!c.isFunction(RedactorPlugins[g])){return}this[g]=RedactorPlugins[g]();var e=this.getModuleMethods(this[g]);var d=e.length;for(var h=0;h<d;h++){this[g][e[h]]=this[g][e[h]].bind(this)}if(c.isFunction(this[g].init)){this[g].init()}},this))},disableMozillaEditing:function(){if(!this.utils.browser("mozilla")){return}try{document.execCommand("enableObjectResizing",false,false);document.execCommand("enableInlineTableEditing",false,false)}catch(d){}}}},button:function(){return{build:function(g,d){var e=c('<a href="#" class="re-icon re-'+g+'" rel="'+g+'" />').attr("tabindex","-1");if(d.func||d.command||d.dropdown){this.button.setEvent(e,g,d)}if(d.dropdown){var f=c('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+g+'" style="display: none;">');e.data("dropdown",f);this.dropdown.build(g,f,d.dropdown)}if(this.utils.isDesktop()){this.button.createTooltip(e,g,d.title)}return e},setEvent:function(e,f,d){e.on("touchstart click",c.proxy(function(h){if(e.hasClass("redactor-button-disabled")){return false}var g="func";var i=d.func;if(d.command){g="command";i=d.command}else{if(d.dropdown){g="dropdown";i=false}}this.button.onClick(h,f,g,i)},this))},createTooltip:function(f,d,g){var e=c("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+d).hide().html(g);e.appendTo("body");f.on("mouseover",function(){if(c(this).hasClass("redactor-button-disabled")){return}var h=f.offset();e.show();e.css({top:(h.top+f.innerHeight())+"px",left:(h.left+f.innerWidth()/2-e.innerWidth()/2)+"px"})});f.on("mouseout",function(){e.hide()})},onClick:function(f,h,d,g){this.button.caretOffset=this.caret.getOffset();f.preventDefault();if(this.utils.browser("msie")){f.returnValue=false}if(d=="command"){this.inline.format(g)}else{if(d=="dropdown"){this.dropdown.show(f,h)}else{this.button.onClickCallback(f,g,h)}}},onClickCallback:function(f,h,g){var d;if(c.isFunction(h)){h.call(this,g)}else{if(h.search(/\./)!="-1"){d=h.split(".");if(typeof this[d[0]]=="undefined"){return}this[d[0]][d[1]](g)}else{this[h](g)}}this.observe.buttons(f,g)},get:function(d){return this.$toolbar.find("a.re-"+d)},setActive:function(d){this.button.get(d).addClass("redactor-act")},setInactive:function(d){this.button.get(d).removeClass("redactor-act")},setInactiveAll:function(d){if(typeof d==="undefined"){this.$toolbar.find("a.re-icon").removeClass("redactor-act")}else{this.$toolbar.find("a.re-icon").not(".re-"+d).removeClass("redactor-act")}},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(d,e){this.button.get(d).addClass("re-"+e)},removeIcon:function(d,e){this.button.get(d).removeClass("re-"+e)},setAwesome:function(e,d){var f=this.button.get(e);f.removeClass("redactor-btn-image").addClass("fa-redactor-btn");f.html('<i class="fa '+d+'"></i>')},addCallback:function(f,g){var e=(g=="dropdown")?"dropdown":"func";var d=f.attr("rel");f.on("touchstart click",c.proxy(function(h){if(f.hasClass("redactor-button-disabled")){return false}this.button.onClick(h,d,e,g)},this))},addDropdown:function(e,g){var d=e.attr("rel");this.button.addCallback(e,"dropdown");var f=c('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+d+'" style="display: none;">');e.data("dropdown",f);if(g){this.dropdown.build(d,f,g)}return f},add:function(e,f){if(!this.opts.toolbar){return}var d=this.button.build(e,{title:f});d.addClass("redactor-btn-image");this.$toolbar.append(c("<li>").append(d));return d},addFirst:function(e,f){if(!this.opts.toolbar){return}var d=this.button.build(e,{title:f});d.addClass("redactor-btn-image");this.$toolbar.prepend(c("<li>").append(d));return d},addAfter:function(h,e,g){if(!this.opts.toolbar){return}var d=this.button.build(e,{title:g});d.addClass("redactor-btn-image");var f=this.button.get(h);if(f.length!==0){f.parent().after(c("<li>").append(d))}else{this.$toolbar.append(c("<li>").append(d))}return d},addBefore:function(h,e,g){if(!this.opts.toolbar){return}var d=this.button.build(e,{title:g});d.addClass("redactor-btn-image");var f=this.button.get(h);if(f.length!==0){f.parent().before(c("<li>").append(d))}else{this.$toolbar.append(c("<li>").append(d))}return d},remove:function(d){this.button.get(d).remove()}}},caret:function(){return{setStart:function(d){if(!this.utils.isBlock(d)){var e=this.utils.createSpaceElement();c(d).prepend(e);this.caret.setEnd(e)}else{this.caret.set(d,0,d,0)}},setEnd:function(d){this.caret.set(d,1,d,1)},set:function(j,i,h,f){j=j[0]||j;h=h[0]||h;if(this.utils.isBlockTag(j.tagName)&&j.innerHTML===""){j.innerHTML=this.opts.invisibleSpace}if(j.tagName=="BR"&&this.opts.linebreaks===false){var d=c(this.opts.emptyHtml)[0];c(j).replaceWith(d);j=d;h=j}this.selection.get();try{this.range.setStart(j,i);this.range.setEnd(h,f)}catch(g){}this.selection.addRange()},setAfter:function(f){try{var d=c(f)[0].tagName;if(d!="BR"&&!this.utils.isBlock(f)){var g=this.utils.createSpaceElement();c(f).after(g);this.caret.setEnd(g)}else{if(d!="BR"&&this.utils.browser("msie")){this.caret.setStart(c(f).next())}else{this.caret.setAfterOrBefore(f,"after")}}}catch(h){var g=this.utils.createSpaceElement();c(f).after(g);this.caret.setEnd(g)}},setBefore:function(d){if(this.utils.isBlock(d)){this.caret.setEnd(c(d).prev())}else{this.caret.setAfterOrBefore(d,"before")}},setAfterOrBefore:function(f,d){if(!this.utils.browser("msie")){this.$editor.focus()}f=f[0]||f;this.selection.get();if(d=="after"){try{this.range.setStartAfter(f);this.range.setEndAfter(f)}catch(g){}}else{try{this.range.setStartBefore(f);this.range.setEndBefore(f)}catch(g){}}this.range.collapse(false);this.selection.addRange()},getOffsetOfElement:function(e){e=e[0]||e;this.selection.get();var d=this.range.cloneRange();d.selectNodeContents(e);d.setEnd(this.range.endContainer,this.range.endOffset);return c.trim(d.toString()).length},getOffset:function(){var g=0;var e=window.getSelection();if(e.rangeCount>0){var d=window.getSelection().getRangeAt(0);var f=d.cloneRange();f.selectNodeContents(this.$editor[0]);f.setEnd(d.endContainer,d.endOffset);g=f.toString().length}return g},setOffset:function(i,d){if(typeof d=="undefined"){d=i}if(!this.focus.isFocused()){this.focus.setStart()}var f=this.selection.get();var e,h=0;var g=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);while(e=g.nextNode()){h+=e.nodeValue.length;if(h>i){this.range.setStart(e,e.nodeValue.length+i-h);i=Infinity}if(h>=d){this.range.setEnd(e,e.nodeValue.length+d-h);break}}this.range.collapse(false);this.selection.addRange()},setToPoint:function(e,d){this.caret.setOffset(e,d)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(e){e=this.clean.savePreCode(e);e=e.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>');e=e.replace(/\$/g,"&#36;");e=e.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">');if(this.opts.replaceDivs){e=this.clean.replaceDivs(e)}if(this.opts.linebreaks){e=this.clean.replaceParagraphsToBr(e)}e=this.clean.saveFormTags(e);var d=c("<div>");d.html(e);var f=d.find("font[style]");if(f.length!==0){f.replaceWith(function(){var h=c(this);var g=c("<span>").attr("style",h.attr("style"));return g.append(h.contents())});e=d.html()}d.remove();e=e.replace(/<font(.*?[^<])>/gi,"");e=e.replace(/<\/font>/gi,"");e=this.tidy.load(e);if(this.opts.paragraphize){e=this.paragraphize.load(e)}e=this.clean.setVerified(e);e=this.clean.convertInline(e);return e},onSync:function(d){d=d.replace(/[\u200B-\u200D\uFEFF]/g,"");d=d.replace(/&#x200b;/gi,"");if(this.opts.cleanSpaces){d=d.replace(/&nbsp;/gi," ")}if(d.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)!=-1){return""}d=d.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2<\/script>");d=this.clean.restoreFormTags(d);var e={"\u2122":"&trade;","\u00a9":"&copy;","\u2026":"&hellip;","\u2014":"&mdash;","\u2010":"&dash;"};c.each(e,function(f,g){d=d.replace(new RegExp(f,"g"),g)});d=d.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>");d=d.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>");d=d.replace(/<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>");d=d.replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>");d=d.replace(/<span(.*?[^>])\srel="(.*?[^>])"(.*?[^>])>/gi,"<span$1$3>");d=d.replace(/<img(.*?[^>])\srel="(.*?[^>])"(.*?[^>])>/gi,"<img$1$3>");d=d.replace(/<img(.*?[^>])\sstyle="" (.*?[^>])>'/gi,"<img$1 $2>");d=d.replace(/<img(.*?[^>])\sstyle (.*?[^>])>'/gi,"<img$1 $2>");d=d.replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1");d=d.replace(/ data-save-url="(.*?[^>])"/gi,"");d=d.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>");d=d.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"");d=d.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"");d=d.replace(/<font(.*?[^<])>/gi,"");d=d.replace(/<\/font>/gi,"");d=this.tidy.load(d);if(this.opts.linkNofollow){d=d.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>");d=d.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')}d=d.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,"");d=d.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>");d=d.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>");return d},onPaste:function(e,d){e=c.trim(e);e=e.replace(/\$/g,"&#36;");e=e.replace(/<span class="s1">/gi,"<span>");e=e.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," ");e=e.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"\t");e=e.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," ");if(this.opts.pastePlainText){return this.clean.getPlainText(e)}if(!this.utils.isSelectAll()&&typeof d=="undefined"){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"])){return this.clean.getPlainText(e,false)}if(this.utils.isCurrentOrParent("PRE")){e=e.replace(/”/g,'"');e=e.replace(/“/g,'"');e=e.replace(/‘/g,"'");e=e.replace(/’/g,"'");return this.clean.getPreCode(e)}if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){e=this.clean.getOnlyImages(e);if(!this.utils.browser("msie")){var f=this.selection.getBlock();if(f&&f.tagName=="P"){e=e.replace(/<img(.*?)>/gi,"<p><img$1></p>")}}return e}if(this.utils.isCurrentOrParent(["TD"])){e=this.clean.onPasteTidy(e,"td");if(this.opts.linebreaks){e=this.clean.replaceParagraphsToBr(e)}e=this.clean.replaceDivsToBr(e);return e}if(this.utils.isCurrentOrParent(["LI"])){return this.clean.onPasteTidy(e,"li")}}e=this.clean.isSingleLine(e,d);if(!this.clean.singleLine){if(this.opts.linebreaks){e=this.clean.replaceParagraphsToBr(e)}if(this.opts.replaceDivs){e=this.clean.replaceDivs(e)}e=this.clean.saveFormTags(e)}e=this.clean.onPasteWord(e);e=this.clean.onPasteExtra(e);e=this.clean.onPasteTidy(e,"all");if(!this.clean.singleLine&&this.opts.paragraphize){e=this.paragraphize.load(e)}e=this.clean.removeDirtyStyles(e);e=this.clean.onPasteRemoveSpans(e);e=this.clean.onPasteRemoveEmpty(e);e=this.clean.convertInline(e);return e},onPasteWord:function(d){d=d.replace(/<!--[\s\S]*?-->/gi,"");d=d.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"");if(/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(d)){d=this.clean.onPasteIeFixLinks(d);d=d.replace(/<img(.*?)v:shapes=(.*?)>/gi,"");d=d.replace(/src="file\:\/\/(.*?)"/,'src=""');d=d.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>");d=d.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>");d=d.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>");d=d.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>");d=d.replace(/·/g,"");d=d.replace(/<p class="Mso(.*?)"/gi,"<p");d=d.replace(/ class=\"(mso[^\"]*)\"/gi,"");d=d.replace(/ class=(mso\w+)/gi,"");d=d.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2");d=d.replace(/\n/g," ");d=d.replace(/<p>\n?<li>/gi,"<li>")}if(this.opts.cleanSpaces){d=d.replace(/(\s|&nbsp;)+/g," ")}return d},onPasteExtra:function(d){d=d.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");d=d.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3");d=d.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">');d=d.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">');d=d.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">');d=d.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">');d=d.replace(/<img>/gi,"");d=d.replace(/\n{3,}/gi,"\n");d=d.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2");d=d.replace(/<p><p>/gi,"<p>");d=d.replace(/<\/p><\/p>/gi,"</p>");d=d.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>");d=d.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>");d=d.replace(/<\/p>\s<p/gi,"</p><p");d=d.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,"");d=d.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>");if(this.utils.browser("mozilla")){d=d.replace(/<br\s?\/?>$/gi,"")}return d},onPasteTidy:function(f,h){var e=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"];var i=false;var g=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];if(h=="all"){i=["p","span","h1","h2","h3","h4","h5","h6"];g=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]}else{if(h=="td"){e=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]}else{if(h=="li"){e=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]}}}var d={deniedTags:(this.opts.deniedTags)?this.opts.deniedTags:false,allowedTags:(this.opts.allowedTags)?this.opts.allowedTags:e,removeComments:true,removePhp:true,removeAttr:(this.opts.removeAttr)?this.opts.removeAttr:false,allowedAttr:(this.opts.allowedAttr)?this.opts.allowedAttr:g,removeEmpty:i};return this.tidy.load(f,d)},onPasteRemoveEmpty:function(d){d=d.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,"");if(!this.opts.linebreaks){d=d.replace(/<br>$/i,"")}return d},onPasteRemoveSpans:function(d){d=d.replace(/<span>(.*?)<\/span>/gi,"$1");d=d.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ");return d},onPasteIeFixLinks:function(e){if(!this.utils.browser("msie")){return e}var d=c.trim(e);if(d.search(/^<a(.*?)>(.*?)<\/a>$/i)===0){e=e.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")}return e},isSingleLine:function(f,e){this.clean.singleLine=false;if(!this.utils.isSelectAll()&&typeof e=="undefined"){var i=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|","");var j=f.match(new RegExp("</("+i+")>","gi"));var h=f.match(/<\/(p|div)>/gi);if(!j&&(h===null||(h&&h.length<=1))){var d=f.match(/<br\s?\/?>/gi);var g=f.match(/<img(.*?[^>])>/gi);if(!d&&!g){this.clean.singleLine=true;f=f.replace(/<\/?(p|div)(.*?)>/gi,"")}}}return f},stripTags:function(d,f){f=(((f||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var e=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return d.replace(e,function(h,g){return f.indexOf("<"+g.toLowerCase()+">")>-1?h:""})},savePreCode:function(d){d=this.clean.savePreFormatting(d);d=this.clean.saveCodeFormatting(d);return d},savePreFormatting:function(d){var e=d.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);if(e!==null){c.each(e,c.proxy(function(g,h){var f=h.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);f[2]=f[2].replace(/<br\s?\/?>/g,"\n");f[2]=f[2].replace(/&nbsp;/g," ");if(this.opts.preSpaces){f[2]=f[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))}f[2]=this.clean.encodeEntities(f[2]);f[2]=f[2].replace(/\$/g,"&#36;");d=d.replace(h,"<pre"+f[1]+">"+f[2]+"</pre>")},this))}return d},saveCodeFormatting:function(d){var e=d.match(/<code(.*?[^>])>(.*?)<\/code>/gi);if(e!==null){c.each(e,c.proxy(function(g,h){var f=h.match(/<code(.*?[^>])>(.*?)<\/code>/i);f[2]=f[2].replace(/&nbsp;/g," ");f[2]=this.clean.encodeEntities(f[2]);f[2]=f[2].replace(/\$/g,"&#36;");d=d.replace(h,"<code"+f[1]+">"+f[2]+"</code>")},this))}return d},getTextFromHtml:function(e){e=e.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var d=document.createElement("div");d.innerHTML=e;e=d.textContent||d.innerText;return c.trim(e)},getPlainText:function(e,d){e=this.clean.getTextFromHtml(e);e=e.replace(/\n/g,"<br />");if(this.opts.paragraphize&&typeof d=="undefined"&&!this.utils.browser("mozilla")){e=this.paragraphize.load(e)}return e},getPreCode:function(d){d=d.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>");d=d.replace(/<img(.*?)>/gi,"&lt;img$1&gt;");d=this.clean.getTextFromHtml(d);if(this.opts.preSpaces){d=d.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))}d=this.clean.encodeEntities(d);return d},getOnlyImages:function(d){d=d.replace(/<img(.*?)>/gi,"[img$1]");d=d.replace(/<([Ss]*?)>/gi,"");d=d.replace(/\[img(.*?)\]/gi,"<img$1>");return d},getOnlyLinksAndImages:function(d){d=d.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]');d=d.replace(/<img(.*?)>/gi,"[img$1]");d=d.replace(/<(.*?)>/gi,"");d=d.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>');d=d.replace(/\[img(.*?)\]/gi,"<img$1>");return d},encodeEntities:function(d){d=String(d).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(d){if(this.utils.browser("msie")){return d}var e=document.createElement("div");e.innerHTML=d;this.clean.clearUnverifiedRemove(c(e));d=e.innerHTML;c(e).remove();return d},clearUnverified:function(){if(this.utils.browser("msie")){return}this.clean.clearUnverifiedRemove(this.$editor);var d=this.$editor.find("h1, h2, h3, h4, h5, h6");d.find("span").removeAttr("style");d.find(this.opts.verifiedTags.join(", ")).removeAttr("style");this.code.sync()},clearUnverifiedRemove:function(d){d.find(this.opts.verifiedTags.join(", ")).removeAttr("style");d.find("span").not('[data-verified="redactor"]').removeAttr("style");d.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(f,g){var e=c(g);e.attr("style",e.attr("rel"))})},cleanEmptyParagraph:function(){var d=this.$editor.find("p").first();if(this.utils.isEmpty(d.html())){d.remove()}},setVerified:function(g){if(this.utils.browser("msie")){return g}g=g.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">');g=g.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var j=g.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(j){var d=j.length;for(var f=0;f<d;f++){try{var h=j[f].replace(/style="(.*?)"/i,'style="$1" rel="$1"');g=g.replace(j[f],h)}catch(k){}}}return g},convertInline:function(f){var d=c("<div />").html(f);var e=this.opts.inlineTags;e.push("span");d.find(e.join(",")).each(function(){var h=c(this);var g=this.tagName.toLowerCase();h.attr("data-redactor-tag",g);if(g=="span"){if(h.attr("style")){h.attr("data-redactor-style",h.attr("style"))}else{if(h.attr("class")){h.attr("data-redactor-class",h.attr("class"))}}}});f=d.html();d.remove();return f},normalizeLists:function(){this.$editor.find("li").each(function(e,f){var d=c(f).next();if(d.length!==0&&(d[0].tagName=="UL"||d[0].tagName=="OL")){c(f).append(d)}})},removeSpaces:function(d){d=d.replace(/\n/g,"");d=d.replace(/[\t]*/g,"");d=d.replace(/\n\s*\n/g,"\n");d=d.replace(/^[\s\n]*/g," ");d=d.replace(/[\s\n]*$/g," ");d=d.replace(/>\s{2,}</g,"> <");d=d.replace(/\n\n/g,"\n");d=d.replace(/[\u200B-\u200D\uFEFF]/g,"");return d},replaceDivs:function(d){if(this.opts.linebreaks){d=d.replace(/<div><br\s?\/?><\/div>/gi,"<br />");d=d.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")}else{d=d.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")}d=d.replace(/<div(.*?[^>])>/gi,"");d=d.replace(/<\/div>/gi,"");return d},replaceDivsToBr:function(d){d=d.replace(/<div\s(.*?)>/gi,"<p>");d=d.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />");d=d.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />");return d},replaceParagraphsToBr:function(d){d=d.replace(/<p\s(.*?)>/gi,"<p>");d=d.replace(/<p><br\s?\/?><\/p>/gi,"<br />");d=d.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />");d=d.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>");return d},saveFormTags:function(d){return d.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(d){return d.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(d){d=c.trim(d.toString());d=this.clean.onSet(d);this.$editor.html(d);this.code.sync();if(d!==""){this.placeholder.remove()}setTimeout(c.proxy(this.buffer.add,this),15);if(this.start===false){this.observe.load()}},get:function(){var d=this.$textarea.val();d=this.tabifier.get(d);return d},sync:function(){setTimeout(c.proxy(this.code.startSync,this),10)},startSync:function(){var d=this.$editor.html();if(this.code.syncCode&&this.code.syncCode==d){return}this.code.syncCode=d;d=this.core.setCallback("syncBefore",d);d=this.clean.onSync(d);this.$textarea.val(d);this.core.setCallback("sync",d);if(this.start===false){this.core.setCallback("change",d)}this.start=false;if(this.autosave.html==false){this.autosave.html=this.code.get()}if(this.opts.codemirror){this.$textarea.next(".CodeMirror").each(function(e,f){f.CodeMirror.setValue(d)})}this.autosave.onChange();this.autosave.enable()},toggle:function(){if(this.opts.visual){this.code.showCode()}else{this.code.showVisual()}},showCode:function(){this.code.offset=this.caret.getOffset();var e=c(window).scrollTop();var g=this.$editor.innerWidth(),d=this.$editor.innerHeight();this.$editor.hide();var f=this.$textarea.val();this.modified=this.clean.removeSpaces(f);f=this.tabifier.get(f);this.$textarea.val(f);if(this.opts.codemirror){this.$textarea.next(".CodeMirror").each(function(h,j){c(j).show();j.CodeMirror.setValue(f);j.CodeMirror.setSize(g,d);j.CodeMirror.refresh();j.CodeMirror.focus()})}else{this.$textarea.height(d).show().focus();this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting);c(window).scrollTop(e);if(this.$textarea[0].setSelectionRange){this.$textarea[0].setSelectionRange(0,0)}this.$textarea[0].scrollTop=0}this.opts.visual=false;this.button.setInactiveInCode();this.button.setActive("html");this.core.setCallback("source",f)},showVisual:function(){var d;if(this.opts.visual){return}if(this.opts.codemirror){this.$textarea.next(".CodeMirror").each(function(e,f){d=f.CodeMirror.getValue()})}else{d=this.$textarea.hide().val()}if(this.modified!==this.clean.removeSpaces(d)){this.code.set(d)}if(this.opts.codemirror){this.$textarea.next(".CodeMirror").hide()}this.$editor.show();if(!this.utils.isEmpty(d)){this.placeholder.remove()}this.caret.setOffset(this.code.offset);this.$textarea.off("keydown.redactor-textarea-indenting");this.button.setActiveInVisual();this.button.setInactive("html");this.observe.load();this.opts.visual=true;this.core.setCallback("visual",d)},textareaIndenting:function(f){if(f.keyCode!==9){return true}var d=this.$textarea;var g=d.get(0).selectionStart;d.val(d.val().substring(0,g)+"\t"+d.val().substring(d.get(0).selectionEnd));d.get(0).selectionStart=d.get(0).selectionEnd=g+1;return false}}},core:function(){return{getObject:function(){return c.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return(this.$toolbar)?this.$toolbar:false},addEvent:function(d){this.core.event=d},getEvent:function(){return this.core.event},setCallback:function(d,g,f){var h=this.opts[d+"Callback"];if(c.isFunction(h)){return(typeof f=="undefined")?h.call(this,g):h.call(this,g,f)}else{return(typeof f=="undefined")?g:f}},destroy:function(){this.core.setCallback("destroy");this.$element.off(".redactor").removeData("redactor");this.$editor.off(".redactor");c(document).off("click.redactor-image-delete."+this.uuid);c(document).off("click.redactor-image-resize-hide."+this.uuid);c(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid);c("body").off("scroll.redactor."+this.uuid);c(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder");this.$editor.removeAttr("contenteditable");var d=this.code.get();this.$toolbar.find("a").each(function(){var e=c(this);if(e.data("dropdown")){e.data("dropdown").remove();e.data("dropdown",{})}});if(this.build.isTextarea()){this.$box.after(this.$element);this.$box.remove();this.$element.val(d).show()}else{this.$box.after(this.$editor);this.$box.remove();this.$element.html(d).show()}if(this.$pasteBox){this.$pasteBox.remove()}if(this.$modalBox){this.$modalBox.remove()}if(this.$modalOverlay){this.$modalOverlay.remove()}c(".redactor-toolbar-tooltip").remove();clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(d,f,e){if(d=="formatting"&&this.opts.formattingAdd){c.each(this.opts.formattingAdd,c.proxy(function(h,j){var g=j.tag,k;if(typeof j["class"]!="undefined"){g=g+"-"+j["class"]}j.type=(this.utils.isBlockTag(j.tag))?"block":"inline";if(typeof j.func!=="undefined"){k=j.func}else{k=(j.type=="inline")?"inline.formatting":"block.formatting"}if(this.opts.linebreaks&&j.type=="block"&&j.tag=="p"){return}this.formatting[g]={tag:j.tag,style:j.style,"class":j["class"],attr:j.attr,data:j.data,clear:j.clear};e[g]={func:k,title:j.title}},this))}c.each(e,c.proxy(function(i,h){var g=c('<a href="#" class="redactor-dropdown-'+i+'">'+h.title+"</a>");if(d=="formatting"){g.addClass("redactor-formatting-"+i)}g.on("click",c.proxy(function(k){k.preventDefault();var j="func";var l=h.func;if(h.command){j="command";l=h.command}else{if(h.dropdown){j="dropdown";l=h.dropdown}}this.button.onClick(k,i,j,l);this.dropdown.hideAll()},this));f.append(g)},this))},show:function(j,n){if(!this.opts.visual){j.preventDefault();return false}var d=this.button.get(n);var k=d.data("dropdown").appendTo(document.body);if(this.utils.isMobile()&&!this.utils.browser("msie")){document.activeElement.blur()}if(d.hasClass("dropact")){this.dropdown.hideAll()}else{this.dropdown.hideAll();this.core.setCallback("dropdownShow",{dropdown:k,key:n,button:d});this.button.setActive(n);d.addClass("dropact");var o=d.offset();var l=k.width();if((o.left+l)>c(document).width()){o.left=Math.max(0,o.left-l)}var g=o.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var m=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset;var i="fixed";if(this.opts.toolbarFixedTarget!==document){m=(this.$toolbar.innerHeight()+this.$toolbar.offset().top)+this.opts.toolbarFixedTopOffset;i="absolute"}k.css({position:i,left:g,top:m+"px"}).show()}else{var m=(d.innerHeight()+o.top)+"px";k.css({position:"absolute",left:g,top:m}).show()}this.core.setCallback("dropdownShown",{dropdown:k,key:n,button:d})}c(document).one("click",c.proxy(this.dropdown.hide,this));this.$editor.one("click",c.proxy(this.dropdown.hide,this));var h=c(document.body);var f=h.width();k.on("mouseover",function(){h.addClass("body-redactor-hidden");h.css("margin-right",(h.width()-f)+"px")});k.on("mouseout",function(){h.removeClass("body-redactor-hidden").css("margin-right",0)});j.stopPropagation()},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact");c(document.body).removeClass("body-redactor-hidden").css("margin-right",0);c(".redactor-dropdown-"+this.uuid).hide();this.core.setCallback("dropdownHide")},hide:function(f){var d=c(f.target);if(!d.hasClass("dropact")){d.removeClass("dropact");this.dropdown.hideAll()}}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700);this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert);this.selection.save();this.selection.get();var d=this.sel.toString();c("#redactor-filename").val(d);this.modal.show()},insert:function(g,k,i){if(typeof g.error!="undefined"){this.modal.close();this.selection.restore();this.core.setCallback("fileUploadError",g);return}var h;if(typeof g=="string"){h=g}else{var j=c("#redactor-filename").val();if(typeof j=="undefined"||j===""){j=g.filename}h='<a href="'+g.filelink+'" id="filelink-marker">'+j+"</a>"}if(k){this.selection.removeMarkers();var d=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(i,d)}else{this.modal.close()}this.selection.restore();this.buffer.set();this.insert.htmlWithoutClean(h);if(typeof g=="string"){return}var f=c(this.$editor.find("a#filelink-marker"));if(f.length!==0){f.removeAttr("id").removeAttr("style")}else{f=false}this.core.setCallback("fileUpload",f,g)}}},focus:function(){return{setStart:function(){this.$editor.focus();var d=this.$editor.children().first();if(d.length===0){return}if(d[0].length===0||d[0].tagName=="BR"||d[0].nodeType==3){return}if(d[0].tagName=="UL"||d[0].tagName=="OL"){var e=d.find("li").first();if(!this.utils.isBlock(e)&&e.text()===""){this.caret.setStart(e);return}}if(this.opts.linebreaks&&!this.utils.isBlockTag(d[0].tagName)){this.selection.get();this.range.setStart(this.$editor[0],0);this.range.setEnd(this.$editor[0],0);this.selection.addRange();return}this.caret.setStart(d)},setEnd:function(){if(this.utils.browser("mozilla")||this.utils.browser("msie")){var d=this.$editor.children().last();this.$editor.focus();this.caret.setEnd(d)}else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]);this.range.collapse(false);this.selection.addRange()}catch(f){}}},isFocused:function(){var d=document.getSelection().focusNode;if(d===null){return false}if(this.opts.linebreaks&&c(d.parentNode).hasClass("redactor-linebreaks")){return true}else{if(!this.utils.isRedactorParent(d.parentNode)){return false}}return this.$editor.is(":focus")}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700);this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert);this.selection.save();this.modal.show()},showEdit:function(f){var e=f.closest("a",this.$editor[0]);this.modal.load("imageEdit",this.lang.get("edit"),705);this.modal.createCancelButton();this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete"));this.image.buttonSave=this.modal.createActionButton(this.lang.get("save"));this.image.buttonDelete.on("click",c.proxy(function(){this.image.remove(f)},this));this.image.buttonSave.on("click",c.proxy(function(){this.image.update(f)},this));c("#redactor-image-title").val(f.attr("alt"));if(!this.opts.imageLink){c(".redactor-image-link-option").hide()}else{var d=c("#redactor-image-link");d.attr("href",f.attr("src"));if(e.length!==0){d.val(e.attr("href"));if(e.attr("target")=="_blank"){c("#redactor-image-link-blank").prop("checked",true)}}}if(!this.opts.imagePosition){c(".redactor-image-position-option").hide()}else{var g=(f.css("display")=="block"&&f.css("float")=="none")?"center":f.css("float");c("#redactor-image-align").val(g)}this.modal.show()},setFloating:function(e){var h=c("#redactor-image-align").val();var f="";var d="";var g="";switch(h){case"left":f="left";g="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":f="right";g="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":d="block";g="auto";break}e.css({"float":f,display:d,margin:g});e.attr("rel",e.attr("style"))},update:function(h){this.image.hideResize();this.buffer.set();var e=h.closest("a",this.$editor[0]);h.attr("alt",c("#redactor-image-title").val());this.image.setFloating(h);var i=c.trim(c("#redactor-image-link").val());if(i!==""){var j="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}";var g=new RegExp("^(http|ftp|https)://"+j,"i");var f=new RegExp("^"+j,"i");if(i.search(g)==-1&&i.search(f)===0&&this.opts.linkProtocol){i=this.opts.linkProtocol+"://"+i}var k=(c("#redactor-image-link-blank").prop("checked"))?true:false;if(e.length===0){var d=c('<a href="'+i+'">'+this.utils.getOuterHtml(h)+"</a>");if(k){d.attr("target","_blank")}h.replaceWith(d)}else{e.attr("href",i);if(k){e.attr("target","_blank")}else{e.removeAttr("target")}}}else{if(e.length!==0){e.replaceWith(this.utils.getOuterHtml(h))}}this.modal.close();this.observe.images();this.code.sync()},setEditable:function(d){if(this.opts.imageEditable){d.on("dragstart",c.proxy(this.image.onDrag,this))}d.on("mousedown",c.proxy(this.image.hideResize,this));d.on("click.redactor touchstart",c.proxy(function(f){this.observe.image=d;if(this.$editor.find("#redactor-image-box").length!==0){return false}this.image.resizer=this.image.loadEditableControls(d);c(document).on("click.redactor-image-resize-hide."+this.uuid,c.proxy(this.image.hideResize,this));this.$editor.on("click.redactor-image-resize-hide."+this.uuid,c.proxy(this.image.hideResize,this));if(!this.opts.imageResizable){return}this.image.resizer.on("mousedown.redactor touchstart.redactor",c.proxy(function(g){this.image.setResizable(g,d)},this))},this))},setResizable:function(f,d){f.preventDefault();this.image.resizeHandle={x:f.pageX,y:f.pageY,el:d,ratio:d.width()/d.height(),h:d.height()};f=f.originalEvent||f;if(f.targetTouches){this.image.resizeHandle.x=f.targetTouches[0].pageX;this.image.resizeHandle.y=f.targetTouches[0].pageY}this.image.startResize()},startResize:function(){c(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",c.proxy(this.image.moveResize,this));c(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",c.proxy(this.image.stopResize,this))},moveResize:function(g){g.preventDefault();g=g.originalEvent||g;var d=this.image.resizeHandle.h;if(g.targetTouches){d+=(g.targetTouches[0].pageY-this.image.resizeHandle.y)}else{d+=(g.pageY-this.image.resizeHandle.y)}var f=Math.round(d*this.image.resizeHandle.ratio);if(d<50||f<100){return}var d=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:f,height:d});this.image.resizeHandle.el.width(f);this.image.resizeHandle.el.height(d);this.code.sync()},stopResize:function(){this.handle=false;c(document).off(".redactor-image-resize");this.image.hideResize()},onDrag:function(d){if(this.$editor.find("#redactor-image-box").length!==0){d.preventDefault();return false}this.$editor.on("drop.redactor-image-inside-drop",c.proxy(function(){setTimeout(c.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop();this.observe.images();this.$editor.off("drop.redactor-image-inside-drop");this.clean.clearUnverified();this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var d=c(this);d.attr("src",d.attr("data-save-url"));d.removeAttr("data-save-url")})},hideResize:function(g){if(g&&c(g.target).closest("#redactor-image-box",this.$editor[0]).length!==0){return}if(g&&g.target.tagName=="IMG"){var d=c(g.target);d.attr("data-save-url",d.attr("src"))}var f=this.$editor.find("#redactor-image-box");if(f.length===0){return}if(this.opts.imageEditable){this.image.editter.remove()}c(this.image.resizer).remove();f.find("img").css({marginTop:f[0].style.marginTop,marginBottom:f[0].style.marginBottom,marginLeft:f[0].style.marginLeft,marginRight:f[0].style.marginRight});f.css("margin","");f.find("img").css("opacity","");f.replaceWith(function(){return c(this).contents()});c(document).off("click.redactor-image-resize-hide."+this.uuid);this.$editor.off("click.redactor-image-resize-hide."+this.uuid);if(typeof this.image.resizeHandle!=="undefined"){this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style"))}this.code.sync()},loadResizableControls:function(e,f){if(this.opts.imageResizable&&!this.utils.isMobile()){var d=c('<span id="redactor-image-resizer" data-redactor="verified"></span>');if(!this.utils.isDesktop()){d.css({width:"15px",height:"15px"})}d.attr("contenteditable",false);f.append(d);f.append(e);return d}else{f.append(e);return false}},loadEditableControls:function(e){var f=c('<span id="redactor-image-box" data-redactor="verified">');f.css("float",e.css("float")).attr("contenteditable",false);if(e[0].style.margin!="auto"){f.css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight});e.css("margin","")}else{f.css({display:"block",margin:"auto"})}e.css("opacity",".5").after(f);if(this.opts.imageEditable){this.image.editter=c('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>");this.image.editter.attr("contenteditable",false);this.image.editter.on("click",c.proxy(function(){this.image.showEdit(e)},this));f.append(this.image.editter);var d=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+d/2+"px")}return this.image.loadResizableControls(e,f)},remove:function(i){var g=c(i);var e=g.closest("a",this.$editor[0]);var f=g.closest("figure",this.$editor[0]);var h=g.parent();if(c("#redactor-image-box").length!==0){h=c("#redactor-image-box").parent()}var d;if(f.length!==0){d=f.next();f.remove()}else{if(e.length!==0){h=e.parent();e.remove()}else{g.remove()}}c("#redactor-image-box").remove();if(f.length!==0){this.caret.setStart(d)}else{this.caret.setStart(h)}this.core.setCallback("imageDelete",g[0].src,g);this.modal.close();this.code.sync()},insert:function(h,l,k){if(typeof h.error!="undefined"){this.modal.close();this.selection.restore();this.core.setCallback("imageUploadError",h);return}var g;if(typeof h=="string"){g=c(h).attr("data-redactor-inserted-image","true")}else{g=c("<img>");g.attr("src",h.filelink).attr("data-redactor-inserted-image","true")}var j=g;var f=this.utils.isCurrentOrParent("P");if(f){j=c("<blockquote />").append(g)}if(l){this.selection.removeMarkers();var d=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(k,d)}else{this.modal.close()}this.selection.restore();this.buffer.set();this.insert.html(this.utils.getOuterHtml(j),false);var i=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");if(f){i.parent().contents().unwrap().wrap("<p />")}else{if(this.opts.linebreaks){i.before("<br>").after("<br>")}}if(typeof h=="string"){return}this.core.setCallback("imageUpload",i,h)}}},indent:function(){return{increase:function(){if(!this.utils.browser("msie")){this.$editor.focus()}this.buffer.set();this.selection.save();var d=this.selection.getBlock();if(d&&d.tagName=="LI"){this.indent.increaseLists()}else{if(d===false&&this.opts.linebreaks){this.indent.increaseText()}else{this.indent.increaseBlocks()}}this.selection.restore();this.code.sync()},increaseLists:function(){document.execCommand("indent");this.indent.fixEmptyIndent();this.clean.normalizeLists();this.clean.clearUnverified()},increaseBlocks:function(){c.each(this.selection.getBlocks(),c.proxy(function(e,f){if(f.tagName==="TD"||f.tagName==="TH"){return}var d=this.utils.getAlignmentElement(f);var g=this.utils.normalize(d.css("margin-left"))+this.opts.indentValue;d.css("margin-left",g+"px")},this))},increaseText:function(){var d=this.selection.wrap("div");c(d).attr("data-tagblock","redactor");c(d).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set();this.selection.save();var d=this.selection.getBlock();if(d&&d.tagName=="LI"){this.indent.decreaseLists()}else{this.indent.decreaseBlocks()}this.selection.restore();this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var f=this.selection.getCurrent();var d=c(f).closest("li",this.$editor[0]);var e=d.parent();if(d.length!==0&&e.length!==0&&e[0].tagName=="LI"){e.after(d)}this.indent.fixEmptyIndent();if(!this.opts.linebreaks&&d.length===0){document.execCommand("formatblock",false,"p");this.$editor.find("ul, ol, blockquote, p").each(c.proxy(this.utils.removeEmpty,this))}this.clean.clearUnverified()},decreaseBlocks:function(){c.each(this.selection.getBlocks(),c.proxy(function(e,f){var d=this.utils.getAlignmentElement(f);var g=this.utils.normalize(d.css("margin-left"))-this.opts.indentValue;if(g<=0){if(this.opts.linebreaks&&typeof(d.data("tagblock"))!=="undefined"){d.replaceWith(d.html()+"<br />")}else{d.css("margin-left","");this.utils.removeEmptyAttr(d,"style")}}else{d.css("margin-left",g+"px")}},this))},fixEmptyIndent:function(){var e=this.selection.getBlock();if(this.range.collapsed&&e&&e.tagName=="LI"&&this.utils.isEmpty(c(e).text())){var d=c(e);d.find("span").not(".redactor-selection-marker").contents().unwrap();d.append("<br>")}}}},inline:function(){return{formatting:function(d){var e,f;if(typeof this.formatting[d].style!="undefined"){e="style"}else{if(typeof this.formatting[d]["class"]!="undefined"){e="class"}}if(e){f=this.formatting[d][e]}this.inline.format(this.formatting[d].tag,e,f)},format:function(d,g,j){if(this.utils.isCurrentOrParent("PRE")||this.utils.isCurrentOrParentHeader()){return}var e=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"];var h=["strong","strong","em","em","u","del","del","sup","sub"];for(var f=0;f<e.length;f++){if(d==e[f]){d=h[f]}}if(this.opts.allowedTags){if(c.inArray(d,this.opts.allowedTags)==-1){return}}else{if(c.inArray(d,this.opts.deniedTags)!==-1){return}}this.inline.type=g||false;this.inline.value=j||false;this.buffer.set();if(!this.utils.browser("msie")){this.$editor.focus()}this.selection.get();if(this.range.collapsed){this.inline.formatCollapsed(d)}else{this.inline.formatMultiple(d)}},formatCollapsed:function(d){var g=this.selection.getCurrent();var f=c(g).closest(d+"[data-redactor-tag="+d+"]",this.$editor[0]);if(f.length!==0&&(this.inline.type!="style"&&f[0].tagName!="SPAN")){if(this.utils.isEmpty(f.text())){this.caret.setAfter(f[0]);f.remove();this.code.sync()}else{if(this.utils.isEndOfElement(f)){this.caret.setAfter(f[0])}}return}var e=c("<"+d+">").attr("data-verified","redactor").attr("data-redactor-tag",d);e.html(this.opts.invisibleSpace);e=this.inline.setFormat(e);var e=this.insert.node(e);this.caret.setEnd(e);this.code.sync()},formatMultiple:function(d){this.inline.formatConvert(d);this.selection.save();document.execCommand("strikethrough");this.$editor.find("strike").each(c.proxy(function(j,l){var h=c(l);this.inline.formatRemoveSameChildren(h,d);var g;if(this.inline.type){g=c("<span>").attr("data-redactor-tag",d).attr("data-verified","redactor");g=this.inline.setFormat(g)}else{g=c("<"+d+">").attr("data-redactor-tag",d).attr("data-verified","redactor")}h.replaceWith(g.html(h.contents()));if(d=="span"){var m=g.parent();if(m&&m[0].tagName=="SPAN"&&this.inline.type=="style"){var f=this.inline.value.split(";");for(var n=0;n<f.length;n++){if(f[n]===""){return}var k=f[n].split(":");m.css(k[0],"");if(this.utils.removeEmptyAttr(m,"style")){m.replaceWith(m.contents())}}}}},this));if(d!="span"){this.$editor.find(this.opts.inlineTags.join(", ")).each(c.proxy(function(g,h){var f=c(h);var j=f.css("text-decoration");if(j=="line-through"){f.css("text-decoration","");this.utils.removeEmptyAttr(f,"style")}},this))}if(d!="del"){var e=this;this.$editor.find("inline").each(function(f,g){e.utils.replaceToTag(g,"del")})}this.selection.restore();this.code.sync()},formatRemoveSameChildren:function(f,d){var e=this;f.children(d).each(function(){var i=c(this);if(!i.hasClass("redactor-selection-marker")){if(e.inline.type=="style"){var g=e.inline.value.split(";");for(var j=0;j<g.length;j++){if(g[j]===""){return}var h=g[j].split(":");i.css(h[0],"");if(e.utils.removeEmptyAttr(i,"style")){i.replaceWith(i.contents())}}}else{i.contents().unwrap()}}})},formatConvert:function(d){this.selection.save();var f="";if(this.inline.type=="class"){f="[data-redactor-class="+this.inline.value+"]"}else{if(this.inline.type=="style"){f='[data-redactor-style="'+this.inline.value+'"]'}}var e=this;if(d!="del"){this.$editor.find("del").each(function(g,h){e.utils.replaceToTag(h,"inline")})}if(d!="span"){this.$editor.find(d).each(function(){var g=c(this);g.replaceWith(c("<strike />").html(g.contents()))})}this.$editor.find('[data-redactor-tag="'+d+'"]'+f).each(function(){if(f===""&&d=="span"&&this.tagName.toLowerCase()==d){return}var g=c(this);g.replaceWith(c("<strike />").html(g.contents()))});this.selection.restore()},setFormat:function(d){switch(this.inline.type){case"class":if(d.hasClass(this.inline.value)){d.removeClass(this.inline.value);d.removeAttr("data-redactor-class")}else{d.addClass(this.inline.value);d.attr("data-redactor-class",this.inline.value)}break;case"style":d[0].style.cssText=this.inline.value;d.attr("data-redactor-style",this.inline.value);break}return d},removeStyle:function(){this.buffer.set();var f=this.selection.getCurrent();var e=this.selection.getInlines();this.selection.save();if(f&&f.tagName==="SPAN"){var d=c(f);d.removeAttr("style");if(d[0].attributes.length===0){d.replaceWith(d.contents())}}c.each(e,c.proxy(function(h,j){var g=c(j);if(c.inArray(j.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!g.hasClass("redactor-selection-marker")){g.removeAttr("style");if(g[0].attributes.length===0){g.replaceWith(g.contents())}}},this));this.selection.restore();this.code.sync()},removeStyleRule:function(f){this.buffer.set();var g=this.selection.getParent();var e=this.selection.getInlines();this.selection.save();if(g&&g.tagName==="SPAN"){var d=c(g);d.css(f,"");this.utils.removeEmptyAttr(d,"style");if(d[0].attributes.length===0){d.replaceWith(d.contents())}}c.each(e,c.proxy(function(j,k){var h=c(k);if(c.inArray(k.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!h.hasClass("redactor-selection-marker")){h.css(f,"");this.utils.removeEmptyAttr(h,"style");if(h[0].attributes.length===0){h.replaceWith(h.contents())}}},this));this.selection.restore();this.code.sync()},removeFormat:function(){this.buffer.set();var d=this.selection.getCurrent();this.selection.save();document.execCommand("removeFormat");if(d&&d.tagName==="SPAN"){c(d).replaceWith(c(d).contents())}c.each(this.selection.getNodes(),c.proxy(function(f,g){var e=c(g);if(c.inArray(g.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!e.hasClass("redactor-selection-marker")){e.replaceWith(e.contents())}},this));this.selection.restore();this.code.sync()},toggleClass:function(d){this.inline.format("span","class",d)},toggleStyle:function(d){this.inline.format("span","style",d)}}},insert:function(){return{set:function(e,d){this.placeholder.remove();e=this.clean.setVerified(e);if(typeof d=="undefined"){e=this.clean.onPaste(e,false)}this.$editor.html(e);this.selection.remove();this.focus.setEnd();this.clean.normalizeLists();this.code.sync();this.observe.load();if(typeof d=="undefined"){setTimeout(c.proxy(this.clean.clearUnverified,this),10)}},text:function(h){this.placeholder.remove();h=h.toString();h=c.trim(h);h=this.clean.getPlainText(h,false);this.$editor.focus();if(this.utils.browser("msie")){this.insert.htmlIe(h)}else{this.selection.get();this.range.deleteContents();var e=document.createElement("div");e.innerHTML=h;var i=document.createDocumentFragment(),g,f;while((g=e.firstChild)){f=i.appendChild(g)}this.range.insertNode(i);if(f){var d=this.range.cloneRange();d.setStartAfter(f);d.collapse(true);this.sel.removeAllRanges();this.sel.addRange(d)}}this.code.sync();this.clean.clearUnverified()},htmlWithoutClean:function(d){this.insert.html(d,false)},html:function(e,d){this.placeholder.remove();if(typeof d=="undefined"){d=true}this.$editor.focus();e=this.clean.setVerified(e);if(d){e=this.clean.onPaste(e)}if(this.utils.browser("msie")){this.insert.htmlIe(e)}else{if(this.clean.singleLine){this.insert.execHtml(e)}else{document.execCommand("insertHTML",false,e)}this.insert.htmlFixMozilla()}this.clean.normalizeLists();if(!this.opts.linebreaks){this.$editor.find("p").each(c.proxy(this.utils.removeEmpty,this))}this.code.sync();this.observe.load();if(d){this.clean.clearUnverified()}},htmlFixMozilla:function(){if(!this.utils.browser("mozilla")){return}var d=c(this.selection.getBlock()).next();if(d.length>0&&d[0].tagName=="P"&&d.html()===""){d.remove()}},htmlIe:function(f){if(this.utils.isIe11()){var g=this.utils.isCurrentOrParent("P");var d=c("<div>").append(f);var e=d.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");if(g&&e){this.insert.ie11FixInserting(g,f)}else{this.insert.ie11PasteFrag(f)}return}document.selection.createRange().pasteHTML(f)},execHtml:function(d){d=this.clean.setVerified(d);this.selection.get();this.range.deleteContents();var e=document.createElement("div");e.innerHTML=d;var h=document.createDocumentFragment(),g,f;while((g=e.firstChild)){f=h.appendChild(g)}this.range.insertNode(h);this.range.collapse(true);this.caret.setAfter(f)},node:function(f,e){f=f[0]||f;var d=this.utils.getOuterHtml(f);d=this.clean.setVerified(d);if(d.match(/</g)!==null){f=c(d)[0]}this.selection.get();if(e!==false){this.range.deleteContents()}this.range.insertNode(f);this.range.collapse(false);this.selection.addRange();return f},nodeToPoint:function(g,d,i){g=g[0]||g;this.selection.get();var e;if(document.caretPositionFromPoint){var h=document.caretPositionFromPoint(d,i);this.range.setStart(h.offsetNode,h.offset);this.range.collapse(true);this.range.insertNode(g)}else{if(document.caretRangeFromPoint){e=document.caretRangeFromPoint(d,i);e.insertNode(g)}else{if(typeof document.body.createTextRange!="undefined"){e=document.body.createTextRange();e.moveToPoint(d,i);var f=e.duplicate();f.moveToPoint(d,i);e.setEndPoint("EndToEnd",f);e.select()}}}},nodeToCaretPositionFromPoint:function(j,h){h=h[0]||h;var f;var d=j.clientX,l=j.clientY;if(document.caretPositionFromPoint){var k=document.caretPositionFromPoint(d,l);var i=document.getSelection();f=i.getRangeAt(0);f.setStart(k.offsetNode,k.offset);f.collapse(true);f.insertNode(h)}else{if(document.caretRangeFromPoint){f=document.caretRangeFromPoint(d,l);f.insertNode(h)}else{if(typeof document.body.createTextRange!="undefined"){f=document.body.createTextRange();f.moveToPoint(d,l);var g=f.duplicate();g.moveToPoint(d,l);f.setEndPoint("EndToEnd",g);f.select()}}}},ie11FixInserting:function(f,e){var g=document.createElement("span");g.className="redactor-ie-paste";this.insert.node(g);var d=c(f).html();d="<p>"+d.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+e+"<p>")+"</p>";c(f).replaceWith(d)},ie11PasteFrag:function(d){this.selection.get();this.range.deleteContents();var e=document.createElement("div");e.innerHTML=d;var h=document.createDocumentFragment(),g,f;while((g=e.firstChild)){f=h.appendChild(g)}this.range.insertNode(h);this.range.collapse(false);this.selection.addRange()}}},keydown:function(){return{init:function(u){if(this.rtePaste){return}var w=u.which;var g=(w>=37&&w<=40);this.keydown.ctrl=u.ctrlKey||u.metaKey;this.keydown.current=this.selection.getCurrent();this.keydown.parent=this.selection.getParent();this.keydown.block=this.selection.getBlock();this.keydown.pre=this.utils.isTag(this.keydown.current,"pre");this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote");this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption");this.shortcuts.init(u,w);this.keydown.checkEvents(g,w);this.keydown.setupBuffer(u,w);this.keydown.addArrowsEvent(g);this.keydown.setupSelectAll(u,w);var s=this.core.setCallback("keydown",u);if(s===false){u.preventDefault();return false}if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(w===this.keyCode.DOWN||w===this.keyCode.RIGHT)){var f=false;var k=false;if(this.keydown.block&&this.keydown.block.tagName==="TD"){k=c(this.keydown.block).closest("table",this.$editor[0])}if(k&&k.find("td").last()[0]===this.keydown.block){f=true}if(this.utils.isEndOfElement()&&f){var p=c(this.opts.emptyHtml);k.after(p);this.caret.setStart(p)}}if(this.opts.enterKey&&w===this.keyCode.DOWN){this.keydown.onArrowDown()}if(!this.opts.enterKey&&w===this.keyCode.ENTER){u.preventDefault();if(!this.range.collapsed){this.range.deleteContents()}return}if(w==this.keyCode.ENTER&&!u.shiftKey&&!u.ctrlKey&&!u.metaKey){var q=this.core.setCallback("enter",u);if(q===false){u.preventDefault();return false}if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(u)===true){return false}var n,v;if(this.keydown.pre){return this.keydown.insertNewLine(u)}else{if(this.keydown.blockquote||this.keydown.figcaption){n=this.selection.getCurrent();v=c(n).next();if(v.length!==0&&v[0].tagName=="BR"){return this.keydown.insertBreakLine(u)}else{if(this.utils.isEndOfElement()&&(n&&n!="SPAN")){return this.keydown.insertDblBreakLine(u)}else{return this.keydown.insertBreakLine(u)}}}else{if(this.opts.linebreaks&&!this.keydown.block){n=this.selection.getCurrent();v=c(this.keydown.current).next();if(v.length!==0&&v[0].tagName=="BR"){return this.keydown.insertBreakLine(u)}else{if(n!==false&&c(n).hasClass("redactor-invisible-space")){this.caret.setAfter(n);c(n).contents().unwrap();return this.keydown.insertDblBreakLine(u)}else{if(this.utils.isEndOfEditor()){return this.keydown.insertDblBreakLine(u)}else{if(v.length===0&&n===false&&typeof v.context!="undefined"){return this.keydown.insertBreakLine(u)}}return this.keydown.insertBreakLine(u)}}}else{if(this.opts.linebreaks&&this.keydown.block){setTimeout(c.proxy(this.keydown.replaceDivToBreakLine,this),1)}else{if(!this.opts.linebreaks&&this.keydown.block){if(this.keydown.block.tagName!=="LI"){setTimeout(c.proxy(this.keydown.replaceDivToParagraph,this),1)}else{n=this.selection.getCurrent();var m=c(n).closest("li",this.$editor[0]);var d=m.closest("ul,ol",this.$editor[0]);if(m.length!==0&&this.utils.isEmpty(m.html())&&d.next().length===0&&this.utils.isEmpty(d.find("li").last().html())){d.find("li").last().remove();var p=c(this.opts.emptyHtml);d.after(p);this.caret.setStart(p);return false}}}else{if(!this.opts.linebreaks&&!this.keydown.block){return this.keydown.insertParagraph(u)}}}}}}}if(w===this.keyCode.ENTER&&(u.ctrlKey||u.shiftKey)){return this.keydown.onShiftEnter(u)}if(w===this.keyCode.TAB||u.metaKey&&w===221||u.metaKey&&w===219){return this.keydown.onTab(u,w)}if(w===this.keyCode.BACKSPACE||w===this.keyCode.DELETE){if(this.utils.browser("mozilla")&&this.keydown.current&&this.keydown.current.tagName==="TD"){u.preventDefault();return false}var o=this.selection.getNodes();if(o){var t=o.length;var j;for(var r=0;r<t;r++){var h=c(o[r]).children("img");if(h.length!==0){var l=this;c.each(h,function(x,i){var e=c(i);if(e.css("float")!="none"){return}l.core.setCallback("imageDelete",i.src,e);j=i})}else{if(o[r].tagName=="IMG"){if(j!=o[r]){this.core.setCallback("imageDelete",o[r].src,c(o[r]));j=o[r]}}}}}}if(w===this.keyCode.BACKSPACE){this.keydown.removeInvisibleSpace();this.keydown.removeEmptyListInTable(u)}this.code.sync()},checkEvents:function(e,d){if(!e&&(this.core.getEvent()=="click"||this.core.getEvent()=="arrow")){this.core.addEvent(false);if(this.keydown.checkKeyEvents(d)){this.buffer.set()}}},checkKeyEvents:function(e){var d=this.keyCode;var f=[d.BACKSPACE,d.DELETE,d.ENTER,d.SPACE,d.ESC,d.TAB,d.CTRL,d.META,d.ALT,d.SHIFT];return(c.inArray(e,f)==-1)?true:false},addArrowsEvent:function(d){if(!d){return}if((this.core.getEvent()=="click"||this.core.getEvent()=="arrow")){this.core.addEvent(false);return}this.core.addEvent("arrow")},setupBuffer:function(f,d){if(this.keydown.ctrl&&d===90&&!f.shiftKey&&!f.altKey&&this.opts.buffer.length){f.preventDefault();this.buffer.undo();return}else{if(this.keydown.ctrl&&d===90&&f.shiftKey&&!f.altKey&&this.opts.rebuffer.length!==0){f.preventDefault();this.buffer.redo();return}else{if(!this.keydown.ctrl){if(d==this.keyCode.BACKSPACE||d==this.keyCode.DELETE||(d==this.keyCode.ENTER&&!f.ctrlKey&&!f.shiftKey)||d==this.keyCode.SPACE){this.buffer.set()}}}}},setupSelectAll:function(f,d){if(this.keydown.ctrl&&d===65){this.utils.enableSelectAll()}else{if(d!=this.keyCode.LEFT_WIN&&!this.keydown.ctrl){this.utils.disableSelectAll()}}},onArrowDown:function(){var d=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(var e=0;e<d.length;e++){if(d[e]){this.keydown.insertAfterLastElement(d[e]);return false}}},onShiftEnter:function(d){this.buffer.set();if(this.utils.isEndOfElement()){return this.keydown.insertDblBreakLine(d)}return this.keydown.insertBreakLine(d)},onTab:function(g,d){if(!this.opts.tabKey){return true}if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===false){return true}g.preventDefault();var f;if(this.keydown.pre&&!g.shiftKey){f=(this.opts.preSpaces)?document.createTextNode(Array(this.opts.preSpaces+1).join("\u00a0")):document.createTextNode("\t");this.insert.node(f);this.code.sync()}else{if(this.opts.tabAsSpaces!==false){f=document.createTextNode(Array(this.opts.tabAsSpaces+1).join("\u00a0"));this.insert.node(f);this.code.sync()}else{if(g.metaKey&&d===219){this.indent.decrease()}else{if(g.metaKey&&d===221){this.indent.increase()}else{if(!g.shiftKey){this.indent.increase()}else{this.indent.decrease()}}}}}return false},replaceDivToBreakLine:function(){var f=this.selection.getBlock();var e=f.innerHTML.replace(/<br\s?\/?>/gi,"");if((f.tagName==="DIV"||f.tagName==="P")&&e===""&&!c(f).hasClass("redactor-editor")){var d=document.createElement("br");c(f).replaceWith(d);this.caret.setBefore(d);this.code.sync();return false}},replaceDivToParagraph:function(){var e=this.selection.getBlock();var d=e.innerHTML.replace(/<br\s?\/?>/gi,"");if(e.tagName==="DIV"&&d===""&&!c(e).hasClass("redactor-editor")){var f=document.createElement("p");f.innerHTML=this.opts.invisibleSpace;c(e).replaceWith(f);this.caret.setStart(f);this.code.sync();return false}else{if(this.opts.cleanStyleOnEnter&&e.tagName=="P"){c(e).removeAttr("class").removeAttr("style")}}},insertParagraph:function(f){f.preventDefault();this.selection.get();var d=document.createElement("p");d.innerHTML=this.opts.invisibleSpace;this.range.deleteContents();this.range.insertNode(d);this.caret.setStart(d);this.code.sync();return false},exitFromBlockquote:function(h){if(!this.utils.isEndOfElement()){return}var f=c.trim(c(this.keydown.block).html());if(f.search(/(<br\s?\/?>){2}$/i)!=-1){h.preventDefault();if(this.opts.linebreaks){var d=document.createElement("br");c(this.keydown.blockquote).after(d);this.caret.setBefore(d);c(this.keydown.block).html(f.replace(/<br\s?\/?>$/i,""))}else{var g=c(this.opts.emptyHtml);c(this.keydown.blockquote).after(g);this.caret.setStart(g)}return true}return},insertAfterLastElement:function(e){if(!this.utils.isEndOfElement()){return}this.buffer.set();if(this.opts.linebreaks){var h=c("<div>").append(c.trim(this.$editor.html())).contents();var g=h.last()[0];if(g.tagName=="SPAN"&&g.innerHTML===""){g=h.prev()[0]}if(this.utils.getOuterHtml(g)!=this.utils.getOuterHtml(e)){return}var d=document.createElement("br");c(e).after(d);this.caret.setAfter(d)}else{if(this.$editor.contents().last()[0]!==e){return}var f=c(this.opts.emptyHtml);c(e).after(f);this.caret.setStart(f)}},insertNewLine:function(f){f.preventDefault();var d=document.createTextNode("\n");this.selection.get();this.range.deleteContents();this.range.insertNode(d);this.caret.setAfter(d);this.code.sync();return false},insertBreakLine:function(d){return this.keydown.insertBreakLineProcessing(d)},insertDblBreakLine:function(d){return this.keydown.insertBreakLineProcessing(d,true)},insertBreakLineProcessing:function(j,i){j.stopPropagation();this.selection.get();var h=document.createElement("br");if(this.utils.browser("msie")){this.range.collapse(false);this.range.setEnd(this.range.endContainer,this.range.endOffset)}else{this.range.deleteContents()}this.range.insertNode(h);var g=c(h).parent("a");if(g.length>0){g.find(h).remove();g.after(h)}if(i===true){var d=c(h).next();if(d.length!==0&&d[0].tagName==="BR"&&this.utils.isEndOfEditor()){this.caret.setAfter(h);this.code.sync();return false}var f=document.createElement("br");this.range.insertNode(f);this.caret.setAfter(f)}else{this.keydown.insertBreakLineProcessingAfter(h)}this.code.sync();return false},insertBreakLineProcessingAfter:function(d){var e=this.utils.createSpaceElement();c(d).after(e);this.selection.selectElement(e);c(e).replaceWith(function(){return c(this).contents()})},removeInvisibleSpace:function(){var d=c(this.keydown.current);if(d.text().search(/^\u200B$/g)===0){d.remove()}},removeEmptyListInTable:function(g){var d=c(this.keydown.current);var f=c(this.keydown.parent);var h=d.closest("td",this.$editor[0]);if(h.length!==0&&d.closest("li",this.$editor[0])&&f.children("li").length===1){if(!this.utils.isEmpty(d.text())){return}g.preventDefault();d.remove();f.remove();this.caret.setStart(h)}}}},keyup:function(){return{init:function(h){if(this.rtePaste){return}var d=h.which;this.keyup.current=this.selection.getCurrent();this.keyup.parent=this.selection.getParent();var g=this.utils.isRedactorParent(c(this.keyup.parent).parent());var f=this.core.setCallback("keyup",h);if(f===false){h.preventDefault();return false}if(!this.opts.linebreaks&&this.keyup.current.nodeType==3&&this.keyup.current.length<=1&&(this.keyup.parent===false||this.keyup.parent.tagName=="BODY")){this.keyup.replaceToParagraph()}if(!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&this.keyup.current.tagName==="DIV"){this.keyup.replaceToParagraph(false)}if(!this.opts.linebreaks&&c(this.keyup.parent).hasClass("redactor-invisible-space")&&(g===false||g[0].tagName=="BODY")){c(this.keyup.parent).contents().unwrap();this.keyup.replaceToParagraph()}if(this.linkify.isEnabled()&&this.linkify.isKey(d)){this.linkify.format()}if(d===this.keyCode.DELETE||d===this.keyCode.BACKSPACE){this.clean.clearUnverified();if(this.observe.image){h.preventDefault();this.image.hideResize();this.buffer.set();this.image.remove(this.observe.image);this.observe.image=false;return false}this.$editor.find("p").each(c.proxy(function(e,j){this.utils.removeEmpty(e,c(j).html())},this));if(this.opts.linebreaks&&this.keyup.current&&this.keyup.current.tagName=="DIV"&&this.utils.isEmpty(this.keyup.current.innerHTML)){c(this.keyup.current).after(this.selection.getMarkerAsHtml());this.selection.restore();c(this.keyup.current).remove()}return this.keyup.formatEmpty(h)}},replaceToParagraph:function(g){var e=c(this.keyup.current);var f;if(g===false){f=c("<p>").append(e.html())}else{f=c("<p>").append(e.clone())}e.replaceWith(f);var d=c(f).next();if(typeof(d[0])!=="undefined"&&d[0].tagName=="BR"){d.remove()}this.caret.setEnd(f)},formatEmpty:function(f){var d=c.trim(this.$editor.html());if(!this.utils.isEmpty(d)){return}f.preventDefault();if(this.opts.linebreaks){this.$editor.html(this.selection.getMarkerAsHtml());this.selection.restore()}else{d="<p><br /></p>";this.$editor.html(d);this.focus.setStart()}this.code.sync();return false}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(d){return(typeof this.opts.curLang[d]!="undefined")?this.opts.curLang[d]:""}}},line:function(){return{insert:function(){this.buffer.set();var d=this.selection.getBlocks();if(d[0]!==false&&this.line.isExceptLastOrFirst(d)){if(!this.utils.browser("msie")){this.$editor.focus()}return}if(this.utils.browser("msie")){this.line.insertInIe()}else{this.line.insertInOthersBrowsers()}},isExceptLastOrFirst:function(h){var i=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"];var g=h[0].tagName.toLowerCase();var f=this.selection.getLastBlock();f=(typeof f=="undefined")?g:f.tagName.toLowerCase();var e=c.inArray(g,i)!=-1;var d=c.inArray(f,i)!=-1;if((e&&d)||e){return true}},insertInIe:function(){this.utils.saveScroll();this.buffer.set();this.insert.node(document.createElement("hr"));this.utils.restoreScroll();this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var d='<p id="redactor-insert-line"><br /></p>';if(this.opts.linebreaks){d='<br id="redactor-insert-line">'}document.execCommand("insertHTML",false,"<hr>"+d);this.line.setFocus();this.code.sync()},setFocus:function(){var e=this.$editor.find("#redactor-insert-line");var d=c(e).next()[0];if(d){this.caret.setAfter(e);e.remove()}else{e.removeAttr("id")}}}},link:function(){return{show:function(d){if(typeof d!="undefined"&&d.preventDefault){d.preventDefault()}this.modal.load("link",this.lang.get("link_insert"),600);this.modal.createCancelButton();this.link.buttonInsert=this.modal.createActionButton(this.lang.get("insert"));this.selection.get();this.link.getData();this.link.cleanUrl();if(this.link.target=="_blank"){c("#redactor-link-blank").prop("checked",true)}this.link.$inputUrl=c("#redactor-link-url");this.link.$inputText=c("#redactor-link-url-text");this.link.$inputText.val(this.link.text);this.link.$inputUrl.val(this.link.url);this.link.buttonInsert.on("click",c.proxy(this.link.insert,this));c(".redactor-link-tooltip").remove();this.selection.save();this.modal.show();this.link.$inputUrl.focus()},cleanUrl:function(){var e=self.location.href.replace(/\/$/i,"");if(typeof this.link.url!=="undefined"){this.link.url=this.link.url.replace(e,"");this.link.url=this.link.url.replace(/^\/#/,"#");this.link.url=this.link.url.replace("mailto:","");if(!this.opts.linkProtocol){var d=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(d,"")}}},getData:function(){this.link.$node=false;var d=c(this.selection.getCurrent()).closest("a",this.$editor[0]);if(d.length!==0&&d[0].tagName==="A"){this.link.$node=d;this.link.url=d.attr("href");this.link.text=d.text();this.link.target=d.attr("target")}else{this.link.text=this.sel.toString();this.link.url="";this.link.target=""}},insert:function(){this.placeholder.remove();var i="";var g=this.link.$inputUrl.val();var j=this.link.$inputText.val();if(c.trim(g)===""){this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){c(this).removeClass("redactor-input-error");c(this).off("keyup")});return}if(g.search("@")!=-1&&/(http|ftp|https):\/\//i.test(g)===false){g="mailto:"+g}else{if(g.search("#")!==0){if(c("#redactor-link-blank").prop("checked")){i="_blank"}var h="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}";var f=new RegExp("^(http|ftp|https)://"+h,"i");var e=new RegExp("^"+h,"i");var d=new RegExp(".(html|php)$","i");if(g.search(f)==-1&&g.search(d)==-1&&g.search(e)===0&&this.opts.linkProtocol){g=this.opts.linkProtocol+"://"+g}}}this.link.set(j,g,i);this.modal.close()},set:function(i,f,h){i=c.trim(i.replace(/<|>/g,""));this.selection.restore();if(i===""&&f===""){return}if(i===""&&f!==""){i=f}if(this.link.$node){this.buffer.set();var d=this.link.$node,e=d.children();if(e.length>0){while(e.length){e=e.children()}e=e.end()}else{e=d}d.attr("href",f);e.text(i);if(h!==""){d.attr("target",h)}else{d.removeAttr("target")}this.selection.selectElement(d);this.code.sync()}else{if(this.utils.browser("mozilla")&&this.link.text===""){var g=c("<a />").attr("href",f).text(i);if(h!==""){g.attr("target",h)}this.insert.node(g);this.selection.selectElement(g)}else{var g;if(this.utils.browser("msie")){g=c('<a href="'+f+'">').text(i);if(h!==""){g.attr("target",h)}g=c(this.insert.node(g));if(this.selection.getText().match(/\s$/)){g.after(" ")}this.selection.selectElement(g)}else{document.execCommand("createLink",false,f);g=c(this.selection.getCurrent()).closest("a",this.$editor[0]);if(this.utils.browser("mozilla")){g=c('a[_moz_dirty=""]')}if(h!==""){g.attr("target",h)}g.removeAttr("style").removeAttr("_moz_dirty");if(this.selection.getText().match(/\s$/)){g.after(" ")}if(this.link.text!==""||this.link.text!=i){g.text(i);this.selection.selectElement(g)}}}this.code.sync();this.core.setCallback("insertedLink",g)}setTimeout(c.proxy(function(){this.observe.links()},this),5)},unlink:function(j){if(typeof j!="undefined"&&j.preventDefault){j.preventDefault()}var g=this.selection.getNodes();if(!g){return}this.buffer.set();var d=g.length;for(var h=0;h<d;h++){var f=c(g[h]).closest("a",this.$editor[0]);f.replaceWith(f.contents())}c(".redactor-link-tooltip").remove();this.code.sync()},toggleClass:function(d){this.link.setClass(d,"toggleClass")},addClass:function(d){this.link.setClass(d,"addClass")},removeClass:function(d){this.link.setClass(d,"removeClass")},setClass:function(e,f){var d=this.selection.getInlinesTags(["a"]);if(d===false){return}c.each(d,function(){c(this)[f](e)})}}},list:function(){return{toggle:function(i){this.placeholder.remove();if(!this.utils.browser("msie")){this.$editor.focus()}this.buffer.set();this.selection.save();var h=this.selection.getParent();var g=c(h).closest("ol, ul",this.$editor[0]);if(!this.utils.isRedactorParent(g)&&g.length!==0){g=false}var j,f;var d=false;if(g&&g.length){d=true;var e=g[0].tagName;j=(i==="orderedlist"&&e==="UL");f=(i==="unorderedlist"&&e==="OL")}if(j){this.utils.replaceToTag(g,"ol")}else{if(f){this.utils.replaceToTag(g,"ul")}else{if(d){this.list.remove(i)}else{this.list.insert(i)}}}this.selection.restore();this.code.sync()},insert:function(e){var k=this.selection.getParent();var j=this.selection.getCurrent();var d=c(j).closest("td, th",this.$editor[0]);if(this.utils.browser("msie")&&this.opts.linebreaks){this.list.insertInIe(e)}else{document.execCommand("insert"+e)}var h=c(this.selection.getParent()).closest("ol, ul",this.$editor[0]);if(d.length!==0){var f=d.prev();var g=d.html();d.html("");if(f&&f.length===1&&(f[0].tagName==="TD"||f[0].tagName==="TH")){c(f).after(d)}else{c(k).prepend(d)}d.html(g)}if(this.utils.isEmpty(h.find("li").text())){var l=h.children("li");l.find("br").remove();l.append(this.selection.getMarkerAsHtml())}if(h.length){var i=h.parent();if(this.utils.isRedactorParent(i)&&i[0].tagName!="LI"&&this.utils.isBlock(i[0])){i.replaceWith(i.contents())}}if(!this.utils.browser("msie")){this.$editor.focus()}this.clean.clearUnverified()},insertInIe:function(j){var k=this.selection.wrap("div");var h=c(k).html();var g=(j=="orderedlist")?c("<ol>"):c("<ul>");var d=c("<li>");if(c.trim(h)===""){d.append(this.selection.getMarkerAsHtml());g.append(d);this.$editor.find("#selection-marker-1").replaceWith(g)}else{var e=h.split(/<br\s?\/?>/gi);if(e){for(var f=0;f<e.length;f++){if(c.trim(e[f])!==""){g.append(c("<li>").html(e[f]))}}}else{d.append(h);g.append(d)}c(k).replaceWith(g)}},remove:function(g){document.execCommand("insert"+g);var f=c(this.selection.getCurrent());this.indent.fixEmptyIndent();if(!this.opts.linebreaks&&f.closest("li, th, td",this.$editor[0]).length===0){document.execCommand("formatblock",false,"p");this.$editor.find("ul, ol, blockquote").each(c.proxy(this.utils.removeEmpty,this))}var e=c(this.selection.getCurrent()).closest("table",this.$editor[0]);var d=e.prev();if(!this.opts.linebreaks&&e.length!==0&&d.length!==0&&d[0].tagName=="BR"){d.remove()}this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit"><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /><label class="redactor-image-link-option">'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" class="redactor-image-link-option" /><label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank"> '+this.lang.get("link_new_tab")+'</label><label class="redactor-image-position-option">'+this.lang.get("image_position")+'</label><select class="redactor-image-position-option" id="redactor-image-align"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+"</option></select></section>",image:String()+'<section id="redactor-modal-image-insert"><div id="redactor-modal-image-droparea"></div></section>',file:String()+'<section id="redactor-modal-file-insert"><div id="redactor-modal-file-upload-box"><label>'+this.lang.get("filename")+'</label><input type="text" id="redactor-filename" /><br><br><div id="redactor-modal-file-upload"></div></div></section>',link:String()+'<section id="redactor-modal-link-insert"><label>URL</label><input type="url" id="redactor-link-url" /><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" /><label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label></section>"};c.extend(this.opts,this.opts.modal)},addCallback:function(d,e){this.modal.callbacks[d]=e},createTabber:function(d){this.modal.$tabber=c("<div>").attr("id","redactor-modal-tabber");d.prepend(this.modal.$tabber)},addTab:function(h,e,g){var f=c('<a href="#" rel="tab'+h+'">').text(e);if(g){f.addClass("active")}var d=this;f.on("click",function(i){i.preventDefault();c(".redactor-tab").hide();c(".redactor-"+c(this).attr("rel")).show();d.modal.$tabber.find("a").removeClass("active");c(this).addClass("active")});this.modal.$tabber.append(f)},addTemplate:function(d,e){this.opts.modal[d]=e},getTemplate:function(d){return this.opts.modal[d]},getModal:function(){return this.$modalBody.find("section")},load:function(d,f,e){this.modal.templateName=d;this.modal.width=e;this.modal.build();this.modal.enableEvents();this.modal.setTitle(f);this.modal.setDraggable();this.modal.setContent();if(typeof this.modal.callbacks[d]!="undefined"){this.modal.callbacks[d].call(this)}},show:function(){if(this.utils.isMobile()&&!this.utils.browser("msie")){document.activeElement.blur()}c(document.body).removeClass("body-redactor-hidden");this.modal.bodyOveflow=c(document.body).css("overflow");c(document.body).css("overflow","hidden");if(this.utils.isMobile()){this.modal.showOnMobile()}else{this.modal.showOnDesktop()}this.$modalOverlay.show();this.$modalBox.show();this.modal.setButtonsWidth();this.utils.saveScroll();if(!this.utils.isMobile()){setTimeout(c.proxy(this.modal.showOnDesktop,this),0);c(window).on("resize.redactor-modal",c.proxy(this.modal.resize,this))}this.core.setCallback("modalOpened",this.modal.templateName,this.$modal);c(document).off("focusin.modal");this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",c.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var d=this.$modal.outerHeight();var f=c(window).height();var e=c(window).width();if(this.modal.width>e){this.$modal.css({width:"96%",marginTop:(f/2-d/2)+"px"});return}if(d>f){this.$modal.css({width:this.modal.width+"px",marginTop:"20px"})}else{this.$modal.css({width:this.modal.width+"px",marginTop:(f/2-d/2)+"px"})}},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){if(this.utils.isMobile()){this.modal.showOnMobile()}else{this.modal.showOnDesktop()}},setTitle:function(d){this.$modalHeader.html(d)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){if(typeof c.fn.draggable==="undefined"){return}this.$modal.draggable({handle:this.$modalHeader});this.$modalHeader.css("cursor","move")},setEnter:function(d){if(d.which!=13){return}d.preventDefault();this.$modal.find("button.redactor-modal-action-btn").click()},createCancelButton:function(){var d=c("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));d.on("click",c.proxy(this.modal.close,this));this.$modalFooter.append(d)},createDeleteButton:function(d){return this.modal.createButton(d,"delete")},createActionButton:function(d){return this.modal.createButton(d,"action")},createButton:function(d,f){var e=c("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+f+"-btn").html(d);this.$modalFooter.append(e);return e},setButtonsWidth:function(){var d=this.$modalFooter.find("button");var e=d.length;if(e===0){return}d.css("width",(100/e)+"%")},build:function(){this.modal.buildOverlay();this.$modalBox=c('<div id="redactor-modal-box" />').hide();this.$modal=c('<div id="redactor-modal" />');this.$modalHeader=c("<header />");this.$modalClose=c('<span id="redactor-modal-close" />').html("&times;");this.$modalBody=c('<div id="redactor-modal-body" />');this.$modalFooter=c("<footer />");this.$modal.append(this.$modalHeader);this.$modal.append(this.$modalClose);this.$modal.append(this.$modalBody);this.$modal.append(this.$modalFooter);this.$modalBox.append(this.$modal);this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=c('<div id="redactor-modal-overlay">').hide();c("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",c.proxy(this.modal.close,this));c(document).on("keyup.redactor-modal",c.proxy(this.modal.closeHandler,this));this.$editor.on("keyup.redactor-modal",c.proxy(this.modal.closeHandler,this));this.$modalBox.on("click.redactor-modal",c.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal");c(document).off("keyup.redactor-modal");this.$editor.off("keyup.redactor-modal");this.$modalBox.off("click.redactor-modal");c(window).off("resize.redactor-modal")},closeHandler:function(d){if(d.which!=this.keyCode.ESC){return}this.modal.close(false)},close:function(d){if(d){if(!c(d.target).hasClass("redactor-modal-close-btn")&&d.target!=this.$modalClose[0]&&d.target!=this.$modalBox[0]){return}d.preventDefault()}if(!this.$modalBox){return}this.modal.disableEvents();this.$modalOverlay.remove();this.$modalBox.fadeOut("fast",c.proxy(function(){this.$modalBox.remove();setTimeout(c.proxy(this.utils.restoreScroll,this),0);if(d!==undefined){this.selection.restore()}c(document.body).css("overflow",this.modal.bodyOveflow);this.core.setCallback("modalClosed",this.modal.templateName)},this))}}},observe:function(){return{load:function(){this.observe.images();this.observe.links()},buttons:function(h,j){var g=this.selection.getCurrent();var d=this.selection.getParent();if(h!==false){this.button.setInactiveAll()}else{this.button.setInactiveAll(j)}if(h===false&&j!=="html"){if(c.inArray(j,this.opts.activeButtons)!=-1){this.button.toggleActive(j)}return}c.each(this.opts.activeButtonsStates,c.proxy(function(e,m){var k=c(d).closest(e,this.$editor[0]);var l=c(g).closest(e,this.$editor[0]);if(k.length!==0&&!this.utils.isRedactorParent(k)){return}if(!this.utils.isRedactorParent(l)){return}if(k.length!==0||l.closest(e,this.$editor[0]).length!==0){this.button.setActive(m)}},this));var f=c(d).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(this.utils.isRedactorParent(d)&&f.length){var i=(f.css("text-align")==="")?"left":f.css("text-align");this.button.setActive("align"+i)}},addButton:function(d,e){this.opts.activeButtons.push(e);this.opts.activeButtonsStates[d]=e},images:function(){this.$editor.find("img").each(c.proxy(function(f,d){var e=c(d);e.closest("a",this.$editor[0]).on("click",function(g){g.preventDefault()});if(this.utils.browser("msie")){e.attr("unselectable","on")}this.image.setEditable(e)},this));c(document).on("click.redactor-image-delete."+this.uuid,c.proxy(function(d){this.observe.image=false;if(d.target.tagName=="IMG"&&this.utils.isRedactorParent(d.target)){this.observe.image=(this.observe.image&&this.observe.image==d.target)?false:d.target}},this))},links:function(){if(!this.opts.linkTooltip){return}this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,c.proxy(this.observe.showTooltip,this));this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,c.proxy(this.observe.closeTooltip,this));c(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,c.proxy(this.observe.closeTooltip,this))},getTooltipPosition:function(d){return d.offset()},showTooltip:function(f){var m=c(f.target);if(m[0].tagName=="IMG"){return}if(m[0].tagName!=="A"){m=m.closest("a",this.$editor[0])}if(m[0].tagName!=="A"){return}var g=m;var i=this.observe.getTooltipPosition(g);var l=c('<span class="redactor-link-tooltip"></span>');var d=g.attr("href");if(d===undefined){d=""}if(d.length>24){d=d.substring(0,24)+"..."}var h=c('<a href="'+g.attr("href")+'" target="_blank" />').html(d).addClass("redactor-link-tooltip-action");var j=c('<a href="#" />').html(this.lang.get("edit")).on("click",c.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action");var k=c('<a href="#" />').html(this.lang.get("unlink")).on("click",c.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");l.append(h).append(" | ").append(j).append(" | ").append(k);l.css({top:(i.top+parseInt(g.css("line-height"),10))+"px",left:i.left+"px"});c(".redactor-link-tooltip").remove();c("body").append(l)},closeTooltip:function(g){g=g.originalEvent||g;var f=g.target;var d=c(f).closest("a",this.$editor[0]);if(d.length!==0&&d[0].tagName==="A"&&f.tagName!=="A"){return}else{if((f.tagName==="A"&&this.utils.isRedactorParent(f))||c(f).hasClass("redactor-link-tooltip-action")){return}}c(".redactor-link-tooltip").remove()}}},paragraphize:function(){return{load:function(d){if(this.opts.linebreaks){return d}if(d===""||d==="<p></p>"){return this.opts.emptyHtml}d=d+"\n";this.paragraphize.safes=[];this.paragraphize.z=0;d=d.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>");d=this.paragraphize.getSafes(d);d=this.paragraphize.getSafesComments(d);d=this.paragraphize.replaceBreaksToNewLines(d);d=this.paragraphize.replaceBreaksToParagraphs(d);d=this.paragraphize.clear(d);d=this.paragraphize.restoreSafes(d);d=d.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>");return c.trim(d)},getSafes:function(e){var d=c("<div />").append(e);d.find("blockquote p").replaceWith(function(){return c(this).append("<br />").contents()});e=d.html();d.find(this.opts.paragraphizeBlocks.join(", ")).each(c.proxy(function(f,g){this.paragraphize.z++;this.paragraphize.safes[this.paragraphize.z]=g.outerHTML;e=e.replace(g.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this));return e},getSafesComments:function(e){var d=e.match(/<!--([\w\W]*?)-->/gi);if(!d){return e}c.each(d,c.proxy(function(f,g){this.paragraphize.z++;this.paragraphize.safes[this.paragraphize.z]=g;e=e.replace(g,"\n{replace"+this.paragraphize.z+"}")},this));return e},restoreSafes:function(d){c.each(this.paragraphize.safes,function(e,f){f=(typeof f!=="undefined")?f.replace(/\$/g,"&#36;"):f;d=d.replace("{replace"+e+"}",f)});return d},replaceBreaksToParagraphs:function(f){var g=f.split(new RegExp("\n","g"),-1);f="";if(g){var d=g.length;for(var e=0;e<d;e++){if(!g.hasOwnProperty(e)){return}if(g[e].search("{replace")==-1){g[e]=g[e].replace(/<p>\n\t?<\/p>/gi,"");g[e]=g[e].replace(/<p><\/p>/gi,"");if(g[e]!==""){f+="<p>"+g[e].replace(/^\n+|\n+$/g,"")+"</p>"}}else{f+=g[e]}}}return f},replaceBreaksToNewLines:function(d){d=d.replace(/<br \/>\s*<br \/>/gi,"\n\n");d=d.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />");d=d.replace(new RegExp("\r\n","g"),"\n");d=d.replace(new RegExp("\r","g"),"\n");d=d.replace(new RegExp("/\n\n+/"),"g","\n\n");return d},clear:function(d){d=d.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>");d=d.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>");d=d.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>");d=d.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>");d=d.replace(new RegExp("<p><p ","gi"),"<p ");d=d.replace(new RegExp("<p><p>","gi"),"<p>");d=d.replace(new RegExp("</p></p>","gi"),"</p>");d=d.replace(new RegExp("<p>\\s?</p>","gi"),"");d=d.replace(new RegExp("\n</p>","gi"),"</p>");d=d.replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>");d=d.replace(new RegExp("<p>\t*</p>","gi"),"");return d}}},paste:function(){return{init:function(d){if(!this.opts.cleanOnPaste){setTimeout(c.proxy(this.code.sync,this),1);return}this.rtePaste=true;this.buffer.set();this.selection.save();this.utils.saveScroll();this.paste.createPasteBox();c(window).on("scroll.redactor-freeze",c.proxy(function(){c(window).scrollTop(this.saveBodyScroll)},this));setTimeout(c.proxy(function(){var e=this.$pasteBox.html();this.$pasteBox.remove();this.selection.restore();this.utils.restoreScroll();this.paste.insert(e);c(window).off("scroll.redactor-freeze");if(this.linkify.isEnabled()){this.linkify.format()}},this),1)},createPasteBox:function(){this.$pasteBox=c("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"});if(this.utils.browser("msie")){this.$box.append(this.$pasteBox)}else{c("body").append(this.$pasteBox)}this.$pasteBox.focus()},insert:function(d){d=this.core.setCallback("pasteBefore",d);d=(this.utils.isSelectAll())?this.clean.onPaste(d,false):this.clean.onPaste(d);d=this.core.setCallback("paste",d);if(this.utils.isSelectAll()){this.insert.set(d,false)}else{this.insert.html(d,false)}this.utils.disableSelectAll();this.rtePaste=false;setTimeout(c.proxy(this.clean.clearUnverified,this),10);setTimeout(c.proxy(function(){var e=this.$editor.find("span");c.each(e,function(g,h){var f=h.innerHTML.replace(/[\u200B-\u200D\uFEFF]/,"");if(f===""&&h.attributes.length===0){c(h).remove()}})},this),10)}}},placeholder:function(){return{enable:function(){if(!this.placeholder.is()){return}this.$editor.attr("placeholder",this.$element.attr("placeholder"));this.placeholder.toggle();this.$editor.on("keyup.redactor-placeholder",c.proxy(this.placeholder.toggle,this))},toggle:function(){var d="removeClass";if(this.utils.isEmpty(this.$editor.html(),false)){d="addClass"}this.$editor[d]("redactor-placeholder")},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){if(this.opts.placeholder){return this.$element.attr("placeholder",this.opts.placeholder)}else{return !(typeof this.$element.attr("placeholder")=="undefined"||this.$element.attr("placeholder")==="")}}}},progress:function(){return{show:function(){c(document.body).append(c('<div id="redactor-progress"><span></span></div>'));c("#redactor-progress").fadeIn()},hide:function(){c("#redactor-progress").fadeOut(1500,function(){c(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection();if(document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount){this.range=this.sel.getRangeAt(0)}else{this.range=document.createRange()}},addRange:function(){try{this.sel.removeAllRanges()}catch(d){}this.sel.addRange(this.range)},getCurrent:function(){var d=false;this.selection.get();if(this.sel&&this.sel.rangeCount>0){d=this.sel.getRangeAt(0).startContainer}return this.utils.isRedactorParent(d)},getParent:function(d){d=d||this.selection.getCurrent();if(d){return this.utils.isRedactorParent(c(d).parent()[0])}return false},getBlock:function(d){d=d||this.selection.getCurrent();while(d){if(this.utils.isBlockTag(d.tagName)){return(c(d).hasClass("redactor-editor"))?false:d}d=d.parentNode}return false},getInlines:function(e,f){this.selection.get();if(this.range&&this.range.collapsed){return false}var d=[];e=(typeof e=="undefined"||e===false)?this.selection.getNodes():e;var h=this.opts.inlineTags;h.push("span");if(typeof f!=="undefined"){for(var g=0;g<f.length;g++){h.push(f[g])}}c.each(e,c.proxy(function(j,k){if(c.inArray(k.tagName.toLowerCase(),h)!=-1){d.push(k)}},this));return(d.length===0)?false:d},getInlinesTags:function(f){this.selection.get();if(this.range&&this.range.collapsed){return false}var e=[];var d=this.selection.getNodes();c.each(d,c.proxy(function(g,h){if(c.inArray(h.tagName.toLowerCase(),f)!=-1){e.push(h)}},this));return(e.length===0)?false:e},getBlocks:function(d){this.selection.get();if(this.range&&this.range.collapsed){return[this.selection.getBlock()]}var e=[];d=(typeof d=="undefined")?this.selection.getNodes():d;c.each(d,c.proxy(function(f,g){if(this.utils.isBlock(g)){this.selection.lastBlock=g;e.push(g)}},this));return(e.length===0)?[this.selection.getBlock()]:e},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var f=this.selection.getNodesMarker(1);var l=this.selection.getNodesMarker(2);var k=this.range.cloneRange();if(this.range.collapsed===false){var g=k.startContainer;var n=k.startOffset;this.selection.setNodesMarker(k,l,false);k.setStart(g,n);this.selection.setNodesMarker(k,f,true)}else{this.selection.setNodesMarker(k,f,true);l=f}var e=[];var d=0;var o=this;this.$editor.find("*").each(function(){if(this==f){var i=c(this).parent();if(i.length!==0&&i[0].tagName!="BODY"&&o.utils.isRedactorParent(i[0])){e.push(i[0])}e.push(this);d=1}else{if(d>0){e.push(this);d=d+1}}if(this==l){return false}});var h=[];var m=e.length;for(var j=0;j<m;j++){if(e[j].id!="nodes-marker-1"&&e[j].id!="nodes-marker-2"){h.push(e[j])}}this.selection.removeNodesMarkers();return h},getNodesMarker:function(d){return c('<span id="nodes-marker-'+d+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(d,g,f){try{d.collapse(f);d.insertNode(g)}catch(h){}},removeNodesMarkers:function(){c(document).find("span.redactor-nodes-marker").remove();this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(e,d){this.caret.setOffset(e,d)},wrap:function(d){this.selection.get();if(this.range.collapsed){return false}var e=document.createElement(d);e.appendChild(this.range.extractContents());this.range.insertNode(e);return e},selectElement:function(d){this.caret.set(d,0,d,1)},selectAll:function(){this.selection.get();this.range.selectNodeContents(this.$editor[0]);this.selection.addRange()},remove:function(){this.selection.get();this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var e=this.selection.getMarker(1);this.selection.setMarker(this.range,e,true);if(this.range.collapsed===false){var d=this.selection.getMarker(2);this.selection.setMarker(this.range,d,false)}this.savedSel=this.$editor.html()},getMarker:function(d){if(typeof d=="undefined"){d=1}return c('<span id="selection-marker-'+d+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(d){return this.utils.getOuterHtml(this.selection.getMarker(d))},setMarker:function(d,g,f){d=d.cloneRange();try{d.collapse(f);d.insertNode(g)}catch(h){this.focus.setStart()}},restore:function(){var e=this.$editor.find("span#selection-marker-1");var d=this.$editor.find("span#selection-marker-2");if(e.length!==0&&d.length!==0){this.caret.set(e,0,d,0)}else{if(e.length!==0){this.caret.set(e,0,e,0)}else{this.$editor.focus()}}this.selection.removeMarkers();this.savedSel=false},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(d,e){var f=c(e).text().replace(/[\u200B-\u200D\uFEFF]/g,"");if(f===""){c(e).remove()}else{c(e).replaceWith(function(){return c(this).contents()})}})},getText:function(){this.selection.get();return this.sel.toString()},getHtml:function(){var g="";this.selection.get();if(this.sel.rangeCount){var e=document.createElement("div");var d=this.sel.rangeCount;for(var f=0;f<d;++f){e.appendChild(this.sel.getRangeAt(f).cloneContents())}g=e.innerHTML}return this.clean.onSync(g)},replaceWithHtml:function(d){d=this.selection.getMarkerAsHtml(1)+d+this.selection.getMarkerAsHtml(2);this.selection.get();if(window.getSelection&&window.getSelection().getRangeAt){this.range.deleteContents();var g=document.createElement("div");g.innerHTML=d;var f=document.createDocumentFragment(),e;while((e=g.firstChild)){f.appendChild(e)}this.range.insertNode(f)}else{if(document.selection&&document.selection.createRange){this.range.pasteHTML(d)}}this.selection.restore();this.code.sync()}}},shortcuts:function(){return{init:function(f,d){if(!this.opts.shortcuts){if((f.ctrlKey||f.metaKey)&&(d===66||d===73)){f.preventDefault()}return false}c.each(this.opts.shortcuts,c.proxy(function(k,j){var h=k.split(",");var e=h.length;for(var g=0;g<e;g++){if(typeof h[g]==="string"){this.shortcuts.handler(f,c.trim(h[g]),c.proxy(function(){var i;if(j.func.search(/\./)!="-1"){i=j.func.split(".");if(typeof this[i[0]]!="undefined"){this[i[0]][i[1]].apply(this,j.params)}}else{this[j.func].apply(this,j.params)}},this))}}},this))},handler:function(n,p,h){var k={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};var d={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};p=p.toLowerCase().split(" ");var o=k[n.keyCode],m=String.fromCharCode(n.which).toLowerCase(),f="",g={};c.each(["alt","ctrl","meta","shift"],function(e,i){if(n[i+"Key"]&&o!==i){f+=i+"+"}});if(o){g[f+o]=true}if(m){g[f+m]=true;g[f+d[m]]=true;if(f==="shift+"){g[d[m]]=true}}for(var j=0,l=p.length;j<l;j++){if(g[p[j]]){n.preventDefault();return h.apply(this,arguments)}}}}},tabifier:function(){return{get:function(e){if(!this.opts.tabifier){return e}var l=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"];var k=["li","dt","dt","h[1-6]","option","script"];var h=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+l.join("|/?")+"|"+k.join("|")+")[ >]");this.tabifier.lineAfter=new RegExp("^<(br|/?"+l.join("|/?")+"|/"+k.join("|/")+")[ >]");this.tabifier.newLevel=new RegExp("^</?("+h.join("|")+")[ >]");var j=0,n=e.length,m=0,d=null,f=null,q="",g="",p="";this.tabifier.cleanlevel=0;for(;j<n;j++){m=j;if(-1==e.substr(j).indexOf("<")){g+=e.substr(j);return this.tabifier.finish(g)}while(m<n&&e.charAt(m)!="<"){m++}if(j!=m){p=e.substr(j,m-j);if(!p.match(/^\s{2,}$/g)){if("\n"==g.charAt(g.length-1)){g+=this.tabifier.getTabs()}else{if("\n"==p.charAt(0)){g+="\n"+this.tabifier.getTabs();p=p.replace(/^\s+/,"")}}g+=p}if(p.match(/\n/)){g+="\n"+this.tabifier.getTabs()}}d=m;while(m<n&&">"!=e.charAt(m)){m++}q=e.substr(d,m-d);j=m;var o;if("!--"==q.substr(1,3)){if(!q.match(/--$/)){while("-->"!=e.substr(m,3)){m++}m+=2;q=e.substr(d,m-d);j=m}if("\n"!=g.charAt(g.length-1)){g+="\n"}g+=this.tabifier.getTabs();g+=q+">\n"}else{if("!"==q[1]){g=this.tabifier.placeTag(q+">",g)}else{if("?"==q[1]){g+=q+">\n"}else{if(o=q.match(/^<(script|style|pre)/i)){o[1]=o[1].toLowerCase();q=this.tabifier.cleanTag(q);g=this.tabifier.placeTag(q,g);f=String(e.substr(j+1)).toLowerCase().indexOf("</"+o[1]);if(f){p=e.substr(j+1,f);j+=f;g+=p}}else{q=this.tabifier.cleanTag(q);g=this.tabifier.placeTag(q,g)}}}}}return this.tabifier.finish(g)},getTabs:function(){var e="";for(var d=0;d<this.tabifier.cleanlevel;d++){e+="\t"}return e},finish:function(d){d=d.replace(/\n\s*\n/g,"\n");d=d.replace(/^[\s\n]*/,"");d=d.replace(/[\s\n]*$/,"");d=d.replace(/<script(.*?)>\n<\/script>/gi,"<script$1><\/script>");this.tabifier.cleanlevel=0;return d},cleanTag:function(e){var g="";e=e.replace(/\n/g," ");e=e.replace(/\s{2,}/g," ");e=e.replace(/^\s+|\s+$/g," ");var f="";if(e.match(/\/$/)){f="/";e=e.replace(/\/+$/,"")}var d;while(d=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e)){if(d[2]){g+=d[1].toLowerCase()+"="+d[2]}else{if(d[1]){g+=d[1].toLowerCase()}}g+=" ";e=e.substr(d[0].length)}return g.replace(/\s*$/,"")+f+">"},placeTag:function(d,f){var e=d.match(this.tabifier.newLevel);if(d.match(this.tabifier.lineBefore)||e){f=f.replace(/\s*$/,"");f+="\n"}if(e&&"/"==d.charAt(1)){this.tabifier.cleanlevel--}if("\n"==f.charAt(f.length-1)){f+=this.tabifier.getTabs()}if(e&&"/"!=d.charAt(1)){this.tabifier.cleanlevel++}f+=d;if(d.match(this.tabifier.lineAfter)||d.match(this.tabifier.newLevel)){f=f.replace(/ *$/,"")}return f}}},tidy:function(){return{setupAllowed:function(){if(this.opts.allowedTags){this.opts.deniedTags=false}if(this.opts.allowedAttr){this.opts.removeAttr=false}if(this.opts.linebreaks){return}var d=["p","section"];if(this.opts.allowedTags){this.tidy.addToAllowed(d)}if(this.opts.deniedTags){this.tidy.removeFromDenied(d)}},addToAllowed:function(e){var d=e.length;for(var f=0;f<d;f++){if(c.inArray(e[f],this.opts.allowedTags)==-1){this.opts.allowedTags.push(e[f])}}},removeFromDenied:function(e){var d=e.length;for(var f=0;f<d;f++){var g=c.inArray(e[f],this.opts.deniedTags);if(g!=-1){this.opts.deniedTags.splice(g,1)}}},load:function(e,d){this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty};c.extend(this.tidy.settings,d);e=this.tidy.removeComments(e);this.tidy.$div=c("<div />").append(e);this.tidy.replaceTags();this.tidy.replaceStyles();this.tidy.removeTags();this.tidy.removeAttr();this.tidy.removeEmpty();this.tidy.removeParagraphsInLists();this.tidy.removeDataAttr();this.tidy.removeWithoutAttr();e=this.tidy.$div.html();this.tidy.$div.remove();return e},removeComments:function(d){if(!this.tidy.settings.removeComments){return d}return d.replace(/<!--[\s\S]*?-->/gi,"")},replaceTags:function(g){if(!this.tidy.settings.replaceTags){return g}var d=this.tidy.settings.replaceTags.length;var h=[],e=[];for(var f=0;f<d;f++){e.push(this.tidy.settings.replaceTags[f][1]);h.push(this.tidy.settings.replaceTags[f][0])}c.each(h,c.proxy(function(i,j){this.tidy.$div.find(j).replaceWith(function(){return c("<"+e[i]+" />",{html:c(this).html()})})},this))},replaceStyles:function(){if(!this.tidy.settings.replaceStyles){return}var d=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(c.proxy(function(k,j){var g=c(j);var h=g.attr("style");for(var f=0;f<d;f++){if(h&&h.match(new RegExp("^"+this.tidy.settings.replaceStyles[f][0],"i"))){var e=this.tidy.settings.replaceStyles[f][1];g.replaceWith(function(){var i=document.createElement(e);return c(i).append(c(this).contents())})}}},this))},removeTags:function(){if(!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags){this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(d,e){if(e.innerHTML===""){c(e).remove()}else{c(e).contents().unwrap()}})}if(this.tidy.settings.deniedTags){this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(d,e){if(e.innerHTML===""){c(e).remove()}else{c(e).contents().unwrap()}})}},removeAttr:function(){var d;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var h=[],f=[];d=this.tidy.settings.allowedAttr.length;for(var g=0;g<d;g++){h.push(this.tidy.settings.allowedAttr[g][0]);f.push(this.tidy.settings.allowedAttr[g][1])}this.tidy.$div.find("*").each(c.proxy(function(m,k){var j=c(k);var l=c.inArray(j[0].tagName.toLowerCase(),h);var i=this.tidy.removeAttrGetRemoves(l,f,j);if(i){c.each(i,function(o,n){j.removeAttr(n)})}},this))}if(this.tidy.settings.removeAttr){d=this.tidy.settings.removeAttr.length;for(var g=0;g<d;g++){var e=this.tidy.settings.removeAttr[g][1];if(c.isArray(e)){e=e.join(" ")}this.tidy.$div.find(this.tidy.settings.removeAttr[g][0]).removeAttr(e)}}},removeAttrGetRemoves:function(g,f,e){var d=[];if(g==-1){c.each(e[0].attributes,function(h,j){d.push(j.name)})}else{if(f[g]=="*"){d=[]}else{c.each(e[0].attributes,function(h,j){if(c.isArray(f[g])){if(c.inArray(j.name,f[g])==-1){d.push(j.name)}}else{if(f[g]!=j.name){d.push(j.name)}}})}}return d},removeAttrs:function(d,e){e=new RegExp(e,"g");return d.each(function(){var g=c(this);var f=this.attributes.length-1;for(var h=f;h>=0;h--){var j=this.attributes[h];if(j&&j.specified&&j.name.search(e)>=0){g.removeAttr(j.name)}}})},removeEmpty:function(){if(!this.tidy.settings.removeEmpty){return}this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var d=c(this);var e=d.text();e=e.replace(/[\u200B-\u200D\uFEFF]/g,"");e=e.replace(/&nbsp;/gi,"");e=e.replace(/\s/g,"");if(e===""&&d.children().length===0){d.remove()}})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(!this.tidy.settings.removeDataAttr){return}var d=this.tidy.settings.removeDataAttr;if(c.isArray(this.tidy.settings.removeDataAttr)){d=this.tidy.settings.removeDataAttr.join(",")}this.tidy.removeAttrs(this.tidy.$div.find(d),"^(data-)")},removeWithoutAttr:function(){if(!this.tidy.settings.removeWithoutAttr){return}this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){if(this.attributes.length===0){c(this).contents().unwrap()}})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show"},unlink:{title:this.lang.get("unlink"),func:"link.unlink"}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons();this.toolbar.hideButtonsOnMobile();this.toolbar.isButtonSourceNeeded();if(this.opts.buttons.length===0){return}this.$toolbar=this.toolbar.createContainer();this.toolbar.setOverflow();this.toolbar.append();this.toolbar.setFormattingTags();this.toolbar.loadButtons();this.toolbar.setFixed();if(this.opts.activeButtons){this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",c.proxy(this.observe.buttons,this))}},createContainer:function(){return c("<ul>").addClass("redactor-toolbar").attr("id","redactor-toolbar-"+this.uuid)},setFormattingTags:function(){c.each(this.opts.toolbar.formatting.dropdown,c.proxy(function(d,e){if(c.inArray(d,this.opts.formatting)==-1){delete this.opts.toolbar.formatting.dropdown[d]}},this))},loadButtons:function(){c.each(this.opts.buttons,c.proxy(function(e,f){if(!this.opts.toolbar[f]){return}if(f==="file"){if(this.opts.fileUpload===false){return}else{if(!this.opts.fileUpload&&this.opts.s3===false){return}}}if(f==="image"){if(this.opts.imageUpload===false){return}else{if(!this.opts.imageUpload&&this.opts.s3===false){return}}}var d=this.opts.toolbar[f];this.$toolbar.append(c("<li>").append(this.button.build(f,d)))},this))},append:function(){if(this.opts.toolbarExternal){this.$toolbar.addClass("redactor-toolbar-external");c(this.opts.toolbarExternal).html(this.$toolbar)}else{this.$box.prepend(this.$toolbar)}},setFixed:function(){if(!this.utils.isDesktop()){return}if(this.opts.toolbarExternal){return}if(!this.opts.toolbarFixed){return}this.toolbar.observeScroll();c(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,c.proxy(this.toolbar.observeScroll,this))},setOverflow:function(){if(this.utils.isMobile()&&this.opts.toolbarOverflow){this.$toolbar.addClass("redactor-toolbar-overflow")}},isButtonSourceNeeded:function(){if(this.opts.source){return}var d=this.opts.buttons.indexOf("html");if(d!==-1){this.opts.buttons.splice(d,1)}},hideButtons:function(){if(this.opts.buttonsHide.length===0){return}c.each(this.opts.buttonsHide,c.proxy(function(e,f){var d=this.opts.buttons.indexOf(f);this.opts.buttons.splice(d,1)},this))},hideButtonsOnMobile:function(){if(!this.utils.isMobile()||this.opts.buttonsHideOnMobile.length===0){return}c.each(this.opts.buttonsHideOnMobile,c.proxy(function(e,f){var d=this.opts.buttons.indexOf(f);this.opts.buttons.splice(d,1)},this))},observeScroll:function(){var e=c(this.opts.toolbarFixedTarget).scrollTop();var d=1;if(this.opts.toolbarFixedTarget===document){d=this.$box.offset().top}if(e>d){this.toolbar.observeScrollEnable(e,d)}else{this.toolbar.observeScrollDisable()}},observeScrollEnable:function(i,f){var h=this.opts.toolbarFixedTopOffset+i-f;var g=0;var d=f+this.$box.height()-32;var e=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box");this.$toolbar.css({position:"absolute",width:e,top:h+"px",left:g});if(i>d){c(".redactor-dropdown-"+this.uuid+":visible").hide()}this.toolbar.setDropdownsFixed();this.$toolbar.css("visibility",(i<d)?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"});this.toolbar.unsetDropdownsFixed();this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var e=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset;var d="fixed";if(this.opts.toolbarFixedTarget!==document){e=(this.$toolbar.innerHeight()+this.$toolbar.offset().top)+this.opts.toolbarFixedTopOffset;d="absolute"}c(".redactor-dropdown-"+this.uuid).each(function(){c(this).css({position:d,top:e+"px"})})},unsetDropdownsFixed:function(){var d=(this.$toolbar.innerHeight()+this.$toolbar.offset().top);c(".redactor-dropdown-"+this.uuid).each(function(){c(this).css({position:"absolute",top:d+"px"})})}}},upload:function(){return{init:function(f,d,e){this.upload.direct=false;this.upload.callback=e;this.upload.url=d;this.upload.$el=c(f);this.upload.$droparea=c('<div id="redactor-droparea" />');this.upload.$placeholdler=c('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label"));this.upload.$input=c('<input type="file" name="file" />');this.upload.$placeholdler.append(this.upload.$input);this.upload.$droparea.append(this.upload.$placeholdler);this.upload.$el.append(this.upload.$droparea);this.upload.$droparea.off("redactor.upload");this.upload.$input.off("redactor.upload");this.upload.$droparea.on("dragover.redactor.upload",c.proxy(this.upload.onDrag,this));this.upload.$droparea.on("dragleave.redactor.upload",c.proxy(this.upload.onDragLeave,this));this.upload.$input.on("change.redactor.upload",c.proxy(function(g){g=g.originalEvent||g;this.upload.traverseFile(this.upload.$input[0].files[0],g)},this));this.upload.$droparea.on("drop.redactor.upload",c.proxy(function(g){g.preventDefault();this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop");this.upload.onDrop(g)},this))},directUpload:function(d,f){this.upload.direct=true;this.upload.traverseFile(d,f)},onDrop:function(f){f=f.originalEvent||f;var d=f.dataTransfer.files;this.upload.traverseFile(d[0],f)},traverseFile:function(f,h){if(this.opts.s3){this.upload.setConfig(f);this.upload.s3uploadFile(f);return}var g=!!window.FormData?new FormData():null;if(window.FormData){this.upload.setConfig(f);var d=(this.upload.type=="image")?this.opts.imageUploadParam:this.opts.fileUploadParam;g.append(d,f)}this.progress.show();this.core.setCallback("uploadStart",h,g);this.upload.sendData(g,h)},setConfig:function(d){this.upload.getType(d);if(this.upload.direct){this.upload.url=(this.upload.type=="image")?this.opts.imageUpload:this.opts.fileUpload;this.upload.callback=(this.upload.type=="image")?this.image.insert:this.file.insert}},getType:function(d){this.upload.type="image";if(this.opts.imageTypes.indexOf(d.type)==-1){this.upload.type="file"}},getHiddenFields:function(e,d){if(e===false||typeof e!=="object"){return d}c.each(e,c.proxy(function(g,f){if(f!==null&&f.toString().indexOf("#")===0){f=c(f).val()}d.append(g,f)},this));return d},sendData:function(f,d){if(this.upload.type=="image"){f=this.upload.getHiddenFields(this.opts.uploadImageFields,f);f=this.upload.getHiddenFields(this.upload.imageFields,f)}else{f=this.upload.getHiddenFields(this.opts.uploadFileFields,f);f=this.upload.getHiddenFields(this.upload.fileFields,f)}var g=new XMLHttpRequest();g.open("POST",this.upload.url);g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.onreadystatechange=c.proxy(function(){if(g.readyState==4){var i=g.responseText;i=i.replace(/^\[/,"");i=i.replace(/\]$/,"");var e;try{e=(typeof i==="string"?c.parseJSON(i):i)}catch(h){e={error:true}}this.progress.hide();if(!this.upload.direct){this.upload.$droparea.removeClass("drag-drop")}this.upload.callback(e,this.upload.direct,d)}},this);g.send(f)},onDrag:function(d){d.preventDefault();this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(d){d.preventDefault();this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(d,e){this.upload.imageFields[d]=e},removeImageFields:function(d){delete this.upload.imageFields[d]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(d,e){this.upload.fileFields[d]=e},removeFileFields:function(d){delete this.upload.fileFields[d]},s3uploadFile:function(d){this.upload.s3executeOnSignedUrl(d,c.proxy(function(e){this.upload.s3uploadToS3(d,e)},this))},s3executeOnSignedUrl:function(d,h){var f=new XMLHttpRequest();var g="?";if(this.opts.s3.search(/\?/)!="-1"){g="&"}f.open("GET",this.opts.s3+g+"name="+d.name+"&type="+d.type,true);if(f.overrideMimeType){f.overrideMimeType("text/plain; charset=x-user-defined")}var e=this;f.onreadystatechange=function(i){if(this.readyState==4&&this.status==200){e.progress.show();h(decodeURIComponent(this.responseText))}else{if(this.readyState==4&&this.status!=200){}}};f.send()},s3createCORSRequest:function(f,d){var e=new XMLHttpRequest();if("withCredentials" in e){e.open(f,d,true)}else{if(typeof XDomainRequest!="undefined"){e=new XDomainRequest();e.open(f,d)}else{e=null}}return e},s3uploadToS3:function(e,d){var f=this.upload.s3createCORSRequest("PUT",d);if(!f){}else{f.onload=c.proxy(function(){if(f.status==200){this.progress.hide();var i=d.split("?");if(!i[0]){return false}if(!this.upload.direct){this.upload.$droparea.removeClass("drag-drop")}var h={filelink:i[0]};if(this.upload.type=="file"){var g=i[0].split("/");h.filename=g[g.length-1]}this.upload.callback(h,this.upload.direct,false)}else{}},this);f.onerror=function(){};f.upload.onprogress=function(g){};f.setRequestHeader("Content-Type",e.type);f.setRequestHeader("x-amz-acl","public-read");f.send(e)}}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return !/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(d){return Object.prototype.toString.call(d)=="[object String]"},isEmpty:function(e,d){e=e.replace(/[\u200B-\u200D\uFEFF]/g,"");e=e.replace(/&nbsp;/gi,"");e=e.replace(/<\/?br\s?\/?>/g,"");e=e.replace(/\s/g,"");e=e.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"");e=e.replace(/<iframe(.*?[^>])>$/i,"iframe");e=e.replace(/<source(.*?[^>])>$/i,"source");if(d!==false){e=e.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"");e=e.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")}e=c.trim(e);return e===""},normalize:function(d){if(typeof(d)==="undefined"){return 0}return parseInt(d.replace("px",""),10)},hexToRgb:function(f){if(typeof f=="undefined"){return}if(f.search(/^#/)==-1){return f}var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;f=f.replace(e,function(i,k,j,h){return k+k+j+j+h+h});var d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f);return"rgb("+parseInt(d[1],16)+", "+parseInt(d[2],16)+", "+parseInt(d[3],16)+")"},getOuterHtml:function(d){return c("<div>").append(c(d).eq(0).clone()).html()},getAlignmentElement:function(d){if(c.inArray(d.tagName,this.opts.alignmentTags)!==-1){return c(d)}else{return c(d).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])}},removeEmptyAttr:function(f,d){var e=c(f);if(typeof e.attr(d)=="undefined"){return true}if(e.attr(d)===""){e.removeAttr(d);return true}return false},removeEmpty:function(e,f){var d=c(c.parseHTML(f));d.find(".redactor-invisible-space").removeAttr("style").removeAttr("class");if(d.find("hr, br, img, iframe, source").length!==0){return}var g=c.trim(d.text());if(this.utils.isEmpty(g,false)){d.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop();this.saveBodyScroll=c(window).scrollTop();if(this.opts.scrollTarget){this.saveTargetScroll=c(this.opts.scrollTarget).scrollTop()}},restoreScroll:function(){if(typeof this.saveScroll==="undefined"&&typeof this.saveBodyScroll==="undefined"){return}c(window).scrollTop(this.saveBodyScroll);this.$editor.scrollTop(this.saveEditorScroll);if(this.opts.scrollTarget){c(this.opts.scrollTarget).scrollTop(this.saveTargetScroll)}},createSpaceElement:function(){var d=document.createElement("span");d.className="redactor-invisible-space";d.innerHTML=this.opts.invisibleSpace;return d},removeInlineTags:function(e){var d=this.opts.inlineTags;d.push("span");if(e.tagName=="PRE"){d.push("a")}c(e).find(d.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(e,f){var d=this;c(e).replaceWith(function(){if(f===true){d.utils.removeInlineTags(this)}return c(this).contents()});return c(e)},replaceToTag:function(g,d,h){var f;var e=this;c(g).replaceWith(function(){f=c("<"+d+" />").append(c(this).contents());for(var j=0;j<this.attributes.length;j++){f.attr(this.attributes[j].name,this.attributes[j].value)}if(h===true){e.utils.removeInlineTags(f)}return f});return f},isStartOfElement:function(){var e=this.selection.getBlock();if(!e){return false}var d=this.caret.getOffsetOfElement(e);return(d===0)?true:false},isEndOfElement:function(d){if(typeof d=="undefined"){var d=this.selection.getBlock();if(!d){return false}}var f=this.caret.getOffsetOfElement(d);var e=c.trim(c(d).text()).replace(/\n\r\n/g,"");return(f==e.length)?true:false},isEndOfEditor:function(){var f=this.$editor[0];var e=this.caret.getOffsetOfElement(f);var d=c.trim(c(f).html().replace(/(<([^>]+)>)/gi,""));return(e==d.length)?true:false},isBlock:function(d){d=d[0]||d;return d&&this.utils.isBlockTag(d.tagName)},isBlockTag:function(d){if(typeof d=="undefined"){return false}return this.reIsBlock.test(d)},isTag:function(f,d){var e=c(f).closest(d,this.$editor[0]);if(e.length==1){return e[0]}return false},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=true},disableSelectAll:function(){this.selectAll=false},isRedactorParent:function(d){if(!d){return false}if(c(d).parents(".redactor-editor").length===0||c(d).hasClass("redactor-editor")){return false}return d},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(e){var f=this.selection.getParent();var g=this.selection.getCurrent();if(c.isArray(e)){var d=0;c.each(e,c.proxy(function(h,j){if(this.utils.isCurrentOrParentOne(g,f,j)){d++}},this));return(d===0)?false:true}else{return this.utils.isCurrentOrParentOne(g,f,e)}},isCurrentOrParentOne:function(f,e,d){d=d.toUpperCase();return e&&e.tagName===d?e:f&&f.tagName===d?f:false},isOldIe:function(){return(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9)?true:false},isLessIe10:function(){return(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10)?true:false},isIe11:function(){return !!navigator.userAgent.match(/Trident\/7\./)},browser:function(e){var f=navigator.userAgent.toLowerCase();var d=/(opr)[\/]([\w.]+)/.exec(f)||/(chrome)[ \/]([\w.]+)/.exec(f)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(f)||/(webkit)[ \/]([\w.]+)/.exec(f)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(f)||/(msie) ([\w.]+)/.exec(f)||f.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(f)||f.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(f)||[];if(e=="safari"){return(typeof d[3]!="undefined")?d[3]=="safari":false}if(e=="version"){return d[2]}if(e=="webkit"){return(d[1]=="chrome"||d[1]=="opr"||d[1]=="webkit")}if(d[1]=="rv"){return e=="msie"}if(d[1]=="opr"){return e=="webkit"}return e==d[1]}}},linkify:function(){return{isKey:function(d){return d==this.keyCode.ENTER||d==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var e=this.linkify,d=this.opts;this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return this.nodeType===3&&c.trim(this.nodeValue)!=""&&!c(this).parent().is("pre")&&(this.nodeValue.match(d.linkify.regexps.youtube)||this.nodeValue.match(d.linkify.regexps.vimeo)||this.nodeValue.match(d.linkify.regexps.image)||this.nodeValue.match(d.linkify.regexps.url))}).each(function(){var g=c(this).text(),f=g;if(d.convertVideoLinks&&(f.match(d.linkify.regexps.youtube)||f.match(d.linkify.regexps.vimeo))){f=e.convertVideoLinks(f)}else{if(d.convertImageLinks&&f.match(d.linkify.regexps.image)){f=e.convertImages(f)}else{if(d.convertUrlLinks){f=e.convertLinks(f)}}}c(this).before(g.replace(g,f)).remove()});this.linkify.after()},convertVideoLinks:function(e){var f='<iframe width="500" height="281" src="',d='" frameborder="0" allowfullscreen></iframe>';if(e.match(this.opts.linkify.regexps.youtube)){e=e.replace(this.opts.linkify.regexps.youtube,f+"//www.youtube.com/embed/$1"+d)}if(e.match(this.opts.linkify.regexps.vimeo)){e=e.replace(this.opts.linkify.regexps.vimeo,f+"//player.vimeo.com/video/$2"+d)}return e},convertImages:function(d){var e=d.match(this.opts.linkify.regexps.image);if(e){d=d.replace(d,'<img src="'+e+'" />')}return d},convertLinks:function(j){var h=j.match(this.opts.linkify.regexps.url);if(h){h=c.grep(h,function(n,i){return c.inArray(n,h)===i});var e=h.length;for(var g=0;g<e;g++){var d=h[g],m=d,f=this.opts.linkProtocol+"://";if(d.match(/(https?|ftp):\/\//i)!==null){f=""}if(m.length>this.opts.linkSize){m=m.substring(0,this.opts.linkSize)+"..."}m=decodeURIComponent(m);var l="\\b";if(c.inArray(d.slice(-1),["/","&","="])!=-1){l=""}var k=new RegExp("("+d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+l+")","g");j=j.replace(k,'<a href="'+f+c.trim(d)+'">'+c.trim(m)+"</a>")}}return j},after:function(){this.observe.load();this.code.sync()}}}};c(window).on("load.tools.redactor",function(){c('[data-tools="redactor"]').redactor()});b.prototype.init.prototype=b.prototype})(jQuery);